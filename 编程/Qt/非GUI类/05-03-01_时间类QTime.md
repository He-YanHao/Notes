# Qt 中的时间类

## 日历日期QDate

### 基本功能
`QDate` 类用于处理日历日期（年、月、日），不包含时间信息。

时间日期类需要头文件`#include <QDate>`

**创建日期**

```cpp
QDate date1(2023, 12, 25);  // 2023年12月25日
QDate date2 = QDate::currentDate();  // 当前日期
```

**获取日期信息**

```cpp
int year = date1.year();     // 2023
int month = date1.month();   // 12
int day = date1.day();       // 25
```

**日期操作**

```cpp
QDate tomorrow = date1.addDays(1);
QDate nextMonth = date1.addMonths(1);
QDate nextYear = date1.addYears(1);
```

**日期比较**

```cpp
if (date1 < date2) {
    qDebug() << "date1 is earlier than date2";
}
```

**格式化输出**

```cpp
qDebug() << date1.toString("yyyy-MM-dd");  // "2023-12-25"
qDebug() << date1.toString(Qt::ISODate);   // "2023-12-25"
```

## 时间处理QTime

### 基本功能
`QTime` 类用于处理时钟时间（时、分、秒、毫秒），不包含日期信息。

时间处理类需要头文件`#include <QTime>`

```cpp
// 创建时间
QTime time1(14, 30, 45);  // 14:30:45
QTime time2 = QTime::currentTime();  // 当前时间

// 获取时间信息
int hour = time1.hour();     // 14
int minute = time1.minute(); // 30
int second = time1.second(); // 45
int msec = time1.msec();    // 0

// 时间操作
QTime later = time1.addSecs(3600);  // 加1小时
QTime earlier = time1.addSecs(-1800); // 减30分钟

// 时间差计算
QTime start(9, 0, 0);
QTime end(17, 30, 0);
int secondsBetween = start.secsTo(end);  // 30600秒

// 格式化输出
qDebug() << time1.toString("hh:mm:ss");  // "14:30:45"
qDebug() << time1.toString(Qt::ISODate); // "14:30:45"
```

## 日期时间处理QDateTime

### 基本功能
`QDateTime` 类组合了 `QDate` 和 `QTime`，可以处理完整的日期和时间信息。

时间日期类需要头文件`#include <QDateTime>`

```cpp
// 创建日期时间
QDateTime dt1(QDate(2023, 12, 25), QTime(14, 30, 45));
QDateTime dt2 = QDateTime::currentDateTime();  // 当前日期时间

// 获取信息
QDate date = dt1.date();
QTime time = dt1.time();

// 时间戳转换
qint64 timestamp = dt1.toSecsSinceEpoch();  // 转换为Unix时间戳
QDateTime fromTimestamp = QDateTime::fromSecsSinceEpoch(timestamp);

// 时区处理
QDateTime utc = dt1.toUTC();  // 转换为UTC时间
QDateTime local = utc.toLocalTime();  // 转换回本地时间

// 格式化输出
qDebug() << dt1.toString("yyyy-MM-dd hh:mm:ss");  // "2023-12-25 14:30:45"
qDebug() << dt1.toString(Qt::ISODate);           // "2023-12-25T14:30:45"
```

## 时区处理QTimeZone

### 基本功能

`QTimeZone` 类用于处理时区信息（Qt 5.2+）。

时区处理类需要头文件`#include <QTimeZone>`

**创建时区对象**

```cpp
QTimeZone utcTimeZone("UTC");
QTimeZone londonTimeZone("Europe/London");
QTimeZone localTimeZone = QTimeZone::systemTimeZone();
```

**获取时区信息**

```cpp
QString id = localTimeZone.id();  // 时区ID
int offset = localTimeZone.offsetFromUtc(QDateTime::currentDateTime());  // 与UTC的偏移（秒）
```

**时区转换**

```cpp
QDateTime utcDateTime = QDateTime::currentDateTimeUtc();
QDateTime localDateTime = utcDateTime.toTimeZone(localTimeZone);
```

## 高精度计时QElapsedTimer

### 基本功能

`QElapsedTimer` 类提供高精度计时功能，用于性能测量。

高精度计时类需要头文件`#include <QElapsedTimer>`

```cpp
// 创建并启动计时器
QElapsedTimer timer;
timer.start();

// 执行一些操作
doSomeWork();

// 获取经过的时间
qint64 nanoseconds = timer.nsecsElapsed();
qint64 milliseconds = timer.elapsed();
qint64 seconds = timer.elapsed() / 1000;

qDebug() << "Operation took" << milliseconds << "milliseconds";

// 检查是否超时
if (timer.hasExpired(5000)) {  // 5秒超时
    qDebug() << "Operation timed out";
}
```

## 时间格式化和解析

### 格式化字符串

Qt 使用类似 Unix 的格式化字符串：

| 占位符 | 含义               |
| ------ | ------------------ |
| yyyy   | 4位数年份          |
| MM     | 2位数月份（01-12） |
| dd     | 2位数日期（01-31） |
| hh     | 2位数小时（00-23） |
| mm     | 2位数分钟（00-59） |
| ss     | 2位数秒（00-59）   |
| zzz    | 3位数毫秒          |
| ap     | AM/PM 指示器       |

### 示例

```cpp
QDateTime now = QDateTime::currentDateTime();

// 格式化
QString formatted = now.toString("yyyy-MM-dd hh:mm:ss.zzz");
// 示例输出: "2023-12-25 14:30:45.123"

// 解析
QDateTime parsed = QDateTime::fromString("2023-12-25 14:30:45", "yyyy-MM-dd hh:mm:ss");
```

## 时间计算和比较

```cpp
QDateTime start = QDateTime::currentDateTime();
// ... 执行一些操作 ...
QDateTime end = QDateTime::currentDateTime();

// 计算时间差
qint64 seconds = start.secsTo(end);
qint64 days = start.daysTo(end);

// 日期范围检查
QDate date(2023, 12, 25);
QDate minDate(2023, 1, 1);
QDate maxDate(2023, 12, 31);

if (date >= minDate && date <= maxDate) {
    qDebug() << "Date is within range";
}

// 获取月份天数
int daysInMonth = QDate::currentDate().daysInMonth();
int daysInYear = QDate::currentDate().daysInYear();
```
