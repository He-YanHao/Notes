# 信号 Signals

## 基础介绍

在 Qt 中，信号是一种特殊的成员函数，用于在特定事件发生时通知其他对象。信号有以下特点：

1. **声明方式**：在类的 `signals:` 部分声明
2. **实现**：由 Qt 的 moc（元对象编译器）自动生成实现
3. **调用**：使用 `emit` 关键字发射信号
4. **参数**：可以带有参数，用于传递数据

## 常用组件的信号

### 定时器超时信号QTimer::timeout
**功能**：定时器超时信号
**触发时机**：当定时器达到设定的时间间隔时发射
**使用场景**：定期执行某些操作

```cpp
QTimer *timer = new QTimer(this);
connect(timer, &QTimer::timeout, this, &MainWindow::updateData);
timer->start(1000); // 每秒触发一次
```

### 按钮点击信号QPushButton::clicked
**功能**：按钮点击信号
**触发时机**：当用户点击按钮时发射
**使用场景**：处理按钮点击事件

```cpp
QPushButton *button = new QPushButton("Click me", this);
connect(button, &QPushButton::clicked, this, &MainWindow::handleButtonClick);
```

## 其他常用组件的信号

### QLineEdit 信号
```cpp
QLineEdit *lineEdit = new QLineEdit(this);

// 文本改变时发射
connect(lineEdit, &QLineEdit::textChanged, this, &MainWindow::onTextChanged);

// 编辑完成时发射（按下回车或失去焦点）
connect(lineEdit, &QLineEdit::editingFinished, this, &MainWindow::onEditingFinished);

// 文本被编辑时发射（每输入一个字符）
connect(lineEdit, &QLineEdit::textEdited, this, &MainWindow::onTextEdited);
```

### QComboBox 信号
```cpp
QComboBox *comboBox = new QComboBox(this);

// 当前选项改变时发射
connect(comboBox, QOverload<int>::of(&QComboBox::currentIndexChanged), 
        this, &MainWindow::onComboBoxChanged);

// 当前文本改变时发射
connect(comboBox, &QComboBox::currentTextChanged, 
        this, &MainWindow::onCurrentTextChanged);
```

### QSlider/QSpinBox 信号
```cpp
QSlider *slider = new QSlider(Qt::Horizontal, this);
QSpinBox *spinBox = new QSpinBox(this);

// 值改变时发射
connect(slider, &QSlider::valueChanged, this, &MainWindow::onSliderValueChanged);
connect(spinBox, QOverload<int>::of(&QSpinBox::valueChanged), 
        this, &MainWindow::onSpinBoxValueChanged);
```

### QSerialPort 信号
```cpp
QSerialPort *serial = new QSerialPort(this);

// 有数据可读时发射
connect(serial, &QSerialPort::readyRead, this, &MainWindow::onSerialDataReceived);

// 错误发生时发射
connect(serial, &QSerialPort::errorOccurred, this, &MainWindow::onSerialError);

// 数据写入完成时发射
connect(serial, &QSerialPort::bytesWritten, this, &MainWindow::onBytesWritten);
```

### QAction 信号
```cpp
QAction *action = new QAction("Open", this);

// 动作触发时发射（菜单项点击、工具栏按钮点击等）
connect(action, &QAction::triggered, this, &MainWindow::onOpenAction);
```

### QCheckBox 信号
```cpp
QCheckBox *checkBox = new QCheckBox("Enable", this);

// 状态改变时发射
connect(checkBox, &QCheckBox::stateChanged, this, &MainWindow::onCheckBoxStateChanged);

// 点击时发射（与 stateChanged 类似）
connect(checkBox, &QCheckBox::clicked, this, &MainWindow::onCheckBoxClicked);
```

### QRadioButton 信号
```cpp
QRadioButton *radioButton = new QRadioButton("Option", this);

// 切换时发射
connect(radioButton, &QRadioButton::toggled, this, &MainWindow::onRadioButtonToggled);
```

### QTabWidget 信号
```cpp
QTabWidget *tabWidget = new QTabWidget(this);

// 当前标签页改变时发射
connect(tabWidget, &QTabWidget::currentChanged, this, &MainWindow::onTabChanged);
```

## 连接语法详解

### 现代语法（Qt5 及以上推荐）
```cpp
// 语法：connect(发送者, &发送者类::信号, 接收者, &接收者类::槽函数)
connect(timer, &QTimer::timeout, this, &MainWindow::onTimeout);
connect(button, &QPushButton::clicked, this, &MainWindow::onButtonClicked);
```

### 传统语法（Qt4 风格）
```cpp
// 语法：connect(发送者, SIGNAL(信号(参数)), 接收者, SLOT(槽函数(参数)))
connect(timer, SIGNAL(timeout()), this, SLOT(onTimeout()));
connect(button, SIGNAL(clicked()), this, SLOT(onButtonClicked()));
```

### 带参数的连接
```cpp
// 信号带参数的情况
connect(lineEdit, &QLineEdit::textChanged, 
        this, &MainWindow::onTextChanged);

// 对应的槽函数
void MainWindow::onTextChanged(const QString &text)
{
    qDebug() << "Text changed to:" << text;
}
```

## 自定义信号

您也可以在自己的类中定义信号：

```cpp
class MyClass : public QObject
{
    Q_OBJECT  // 必须包含 Q_OBJECT 宏
    
public:
    MyClass(QObject *parent = nullptr) : QObject(parent) {}
    
signals:
    // 自定义信号
    void dataReady(const QByteArray &data);
    void statusChanged(int status);
    void errorOccurred(const QString &errorMessage);
    
public slots:
    void processData()
    {
        // 处理数据...
        emit dataReady(resultData);  // 发射信号
    }
};
```

## 实际应用示例

```cpp
// 在 MainWindow 构造函数中连接各种信号
MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent)
{
    setupUi(this);  // 假设使用Qt Designer创建的UI
    
    // 连接按钮信号
    connect(ui->startButton, &QPushButton::clicked, this, &MainWindow::onStartButtonClicked);
    connect(ui->stopButton, &QPushButton::clicked, this, &MainWindow::onStopButtonClicked);
    
    // 连接串口信号
    connect(&serialPort, &QSerialPort::readyRead, this, &MainWindow::onSerialDataReceived);
    
    // 连接定时器信号
    QTimer *updateTimer = new QTimer(this);
    connect(updateTimer, &QTimer::timeout, this, &MainWindow::updateUI);
    updateTimer->start(100);  // 每100毫秒更新一次UI
    
    // 连接下拉框信号
    connect(ui->baudRateComboBox, QOverload<int>::of(&QComboBox::currentIndexChanged),
            this, &MainWindow::onBaudRateChanged);
    
    // 连接复选框信号
    connect(ui->autoScrollCheckBox, &QCheckBox::stateChanged,
            this, &MainWindow::onAutoScrollChanged);
}
```

## 注意事项

1. **Q_OBJECT 宏**：自定义信号必须在包含 `Q_OBJECT` 宏的类中声明
2. **参数匹配**：信号的参数必须与槽函数的参数匹配（类型和数量）
3. **内存管理**：确保连接的对象在需要时仍然存在
4. **多次连接**：同一个信号可以连接到多个槽函数
5. **断开连接**：使用 `disconnect()` 可以断开信号槽连接

Qt 的信号槽机制是其最重要的特性之一，它提供了一种强大且类型安全的对象间通信方式，是 Qt 应用程序事件驱动的核心。