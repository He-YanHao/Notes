# Qt 中的坐标类详解

Qt 提供了多个用于处理几何图形和坐标的类，这些类在 GUI 编程、图形绘制和布局管理中非常重要。以下是 Qt 中主要坐标类的详细介绍：

## 1. QPoint / QPointF - 点坐标类

### QPoint（整数坐标）
```cpp
#include <QPoint>

// 创建点
QPoint p1(10, 20);          // (x, y) 坐标
QPoint p2 = QPoint(30, 40);

// 访问坐标
int x = p1.x();             // 获取 x 坐标
int y = p1.y();             // 获取 y 坐标
p1.setX(15);                // 设置 x 坐标
p1.setY(25);                // 设置 y 坐标

// 坐标运算
QPoint p3 = p1 + p2;        // 点相加 (15+30, 25+40) = (45, 65)
QPoint p4 = p1 - p2;        // 点相减 (15-30, 25-40) = (-15, -15)
QPoint p5 = p1 * 2;         // 点乘以标量 (15*2, 25*2) = (30, 50)
QPoint p6 = p1 / 2;         // 点除以标量 (15/2, 25/2) = (7, 12) - 整数除法

// 判断点是否为空（0,0）
bool isNull = p1.isNull();  // 如果 (0,0) 返回 true

// 计算曼哈顿距离（|x1-x2| + |y1-y2|）
int manhattanLength = p1.manhattanLength();
```

### QPointF（浮点坐标）
```cpp
#include <QPointF>

// 创建浮点坐标点
QPointF pf1(10.5, 20.7);
QPointF pf2(30.2, 40.9);

// 与 QPoint 相互转换
QPoint p = pf1.toPoint();   // 浮点转整型（截断小数部分）
QPointF pf = p.toPointF();  // 整型转浮点
```

## 2. QSize / QSizeF - 尺寸类

### QSize（整数尺寸）
```cpp
#include <QSize>

// 创建尺寸
QSize s1(100, 50);         // (width, height)
QSize s2 = QSize(200, 100);

// 访问尺寸
int w = s1.width();        // 获取宽度
int h = s1.height();       // 获取高度
s1.setWidth(150);          // 设置宽度
s1.setHeight(75);          // 设置高度

// 尺寸运算
QSize s3 = s1 + s2;        // 尺寸相加 (100+200, 50+100) = (300, 150)
QSize s4 = s1 - s2;        // 尺寸相减 (100-200, 50-100) = (-100, -50)
QSize s5 = s1 * 2;         // 尺寸乘以标量 (100*2, 50*2) = (200, 100)
QSize s6 = s1 / 2;         // 尺寸除以标量 (100/2, 50/2) = (50, 25)

// 判断尺寸是否有效
bool isEmpty = s1.isEmpty(); // 如果宽度或高度 <= 0 返回 true
bool isNull = s1.isNull();   // 如果宽度和高度都为 0 返回 true

// 缩放尺寸（保持宽高比）
QSize scaled = s1.scaled(200, 100, Qt::KeepAspectRatio);
```

### QSizeF（浮点尺寸）
```cpp
#include <QSizeF>

// 创建浮点尺寸
QSizeF sf1(100.5, 50.7);
QSizeF sf2(200.2, 100.9);

// 与 QSize 相互转换
QSize s = sf1.toSize();    // 浮点转整型（截断小数部分）
QSizeF sf = s.toSizeF();   // 整型转浮点
```

## 3. QRect / QRectF - 矩形类

### QRect（整数矩形）
```cpp
#include <QRect>

// 创建矩形（多种方式）
QRect r1(10, 20, 100, 50);           // (x, y, width, height)
QRect r2 = QRect(QPoint(10, 20), QSize(100, 50)); // 使用点和尺寸
QRect r3 = QRect(10, 20, 100, 50).normalized(); // 规范化矩形（确保宽高为正）

// 访问矩形属性
int x = r1.x();                      // 左上角 x 坐标
int y = r1.y();                      // 左上角 y 坐标
int w = r1.width();                  // 宽度
int h = r1.height();                 // 高度
QPoint topLeft = r1.topLeft();       // 左上角点
QPoint bottomRight = r1.bottomRight(); // 右下角点
QPoint center = r1.center();         // 中心点

// 设置矩形属性
r1.setX(15);
r1.setY(25);
r1.setWidth(150);
r1.setHeight(75);
r1.setTopLeft(QPoint(5, 10));
r1.setBottomRight(QPoint(105, 60));

// 矩形运算
QRect r4 = r1 | r2;                  // 并集（包含两个矩形的最小矩形）
QRect r5 = r1 & r2;                  // 交集（两个矩形重叠部分）
QRect r6 = r1.translated(10, 20);    // 平移矩形（不改变原矩形）
QRect r7 = r1.adjusted(5, 5, -5, -5); // 调整矩形（左,上,右,下）

// 判断关系
bool contains = r1.contains(QPoint(50, 40));    // 点是否在矩形内
bool containsRect = r1.contains(r2);           // 矩形是否完全包含在内部
bool intersects = r1.intersects(r2);           // 矩形是否相交
bool isEmpty = r1.isEmpty();                   // 矩形是否为空（宽或高 <= 0）
bool isNull = r1.isNull();                     // 矩形是否为空（宽和高都为 0）
bool isValid = r1.isValid();                   // 矩形是否有效（宽和高 >= 0）
```

### QRectF（浮点矩形）
```cpp
#include <QRectF>

// 创建浮点矩形
QRectF rf1(10.5, 20.7, 100.5, 50.7);
QRectF rf2 = QRectF(QPointF(10.5, 20.7), QSizeF(100.5, 50.7));

// 与 QRect 相互转换
QRect r = rf1.toRect();      // 浮点转整型（截断小数部分）
QRectF rf = r.toRectF();     // 整型转浮点
```

## 4. QLine / QLineF - 线段类

### QLine（整数线段）
```cpp
#include <QLine>

// 创建线段（多种方式）
QLine l1(10, 20, 110, 70);          // (x1, y1, x2, y2)
QLine l2 = QLine(QPoint(10, 20), QPoint(110, 70));

// 访问线段属性
QPoint p1 = l1.p1();                // 起点
QPoint p2 = l1.p2();                // 终点
int dx = l1.dx();                   // x 方向变化量
int dy = l1.dy();                   // y 方向变化量

// 设置线段属性
l1.setP1(QPoint(15, 25));
l1.setP2(QPoint(115, 75));
l1.setPoints(QPoint(5, 10), QPoint(105, 60));
l1.setLine(20, 30, 120, 80);

// 线段变换
QLine l3 = l1.translated(10, 20);   // 平移线段

// 计算线段属性
qreal angle = l1.angleTo(l2);       // 两条线段之间的角度
```

### QLineF（浮点线段）
```cpp
#include <QLineF>

// 创建浮点线段
QLineF lf1(10.5, 20.7, 110.5, 70.7);
QLineF lf2 = QLineF(QPointF(10.5, 20.7), QPointF(110.5, 70.7));

// 与 QLine 相互转换
QLine l = lf1.toLine();      // 浮点转整型（截断小数部分）
QLineF lf = l.toLineF();     // 整型转浮点

// 计算线段长度和角度
qreal length = lf1.length();        // 线段长度
qreal angle = lf1.angle();          // 线段角度（0-360度）
lf1.setAngle(45.0);                 // 设置角度（保持长度不变）
lf1.setLength(100.0);               // 设置长度（保持角度不变）

// 计算交点
QPointF intersectionPoint;
QLineF::IntersectType type = lf1.intersect(lf2, &intersectionPoint);
```

## 5. QPolygon / QPolygonF - 多边形类

### QPolygon（整数多边形）
```cpp
#include <QPolygon>

// 创建多边形
QPolygon polygon;
polygon << QPoint(10, 20) << QPoint(50, 30) << QPoint(70, 80) << QPoint(30, 90);

// 或者使用初始值列表（C++11）
QPolygon polygon2{QPoint(10, 20), QPoint(50, 30), QPoint(70, 80), QPoint(30, 90)};

// 多边形操作
polygon.append(QPoint(40, 60));     // 添加点
polygon.insert(2, QPoint(25, 45));  // 插入点
polygon.remove(1);                  // 删除点

// 多边形变换
QPolygon translated = polygon.translated(10, 20); // 平移多边形

// 判断点是否在多边形内
bool contains = polygon.containsPoint(QPoint(40, 50), Qt::OddEvenFill);
```

### QPolygonF（浮点多边形）
```cpp
#include <QPolygonF>

// 创建浮点多边形
QPolygonF polygonF;
polygonF << QPointF(10.5, 20.7) << QPointF(50.5, 30.7) << QPointF(70.5, 80.7);

// 与 QPolygon 相互转换
QPolygon p = polygonF.toPolygon();  // 浮点转整型
QPolygonF pf = p.toPolygonF();      // 整型转浮点
```

## 6. 实际应用示例

```cpp
// 创建一个简单的绘图应用
void drawCustomShape(QPainter &painter)
{
    // 定义矩形区域
    QRect rect(50, 50, 200, 150);
    
    // 绘制矩形
    painter.drawRect(rect);
    
    // 计算中心点
    QPoint center = rect.center();
    
    // 从中心点到四个角画线
    painter.drawLine(center, rect.topLeft());
    painter.drawLine(center, rect.topRight());
    painter.drawLine(center, rect.bottomLeft());
    painter.drawLine(center, rect.bottomRight());
    
    // 创建一个多边形（五角星）
    QPolygon star;
    int radius = 40;
    for (int i = 0; i < 5; ++i) {
        double angle = 2 * M_PI * i / 5 - M_PI / 2; // 从顶部开始
        star << QPoint(center.x() + radius * cos(angle),
                      center.y() + radius * sin(angle));
    }
    
    // 绘制多边形
    painter.drawPolygon(star);
}

// 检测鼠标点击是否在特定区域内
bool isInClickableArea(const QPoint &mousePos, const QRect &buttonRect)
{
    return buttonRect.contains(mousePos);
}

// 调整窗口大小并保持内容居中
void resizeAndCenterContent(QWidget *widget, const QSize &contentSize)
{
    QSize widgetSize = widget->size();
    QPoint center((widgetSize.width() - contentSize.width()) / 2,
                  (widgetSize.height() - contentSize.height()) / 2);
    
    // 假设 contentWidget 是显示内容的子部件
    QWidget *contentWidget = widget->findChild<QWidget*>("contentWidget");
    if (contentWidget) {
        contentWidget->setGeometry(QRect(center, contentSize));
    }
}
```

## 总结

Qt 的坐标类提供了丰富的功能来处理几何图形和坐标计算：

1. **QPoint/QPointF**：处理点坐标，支持各种坐标运算
2. **QSize/QSizeF**：处理尺寸，支持缩放和比较操作
3. **QRect/QRectF**：处理矩形区域，支持交集、并集等操作
4. **QLine/QLineF**：处理线段，支持角度和长度计算
5. **QPolygon/QPolygonF**：处理多边形，支持点包含检测

这些类在 Qt 的图形绘制、布局管理、事件处理和自定义控件开发中都有广泛应用。它们提供了整数和浮点两种精度版本，可以根据具体需求选择使用。