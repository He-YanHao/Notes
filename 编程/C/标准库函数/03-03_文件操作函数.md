# 对文件的操作

## 基础函数介绍

### 文件打开 fopen

```c
FILE *fopen(const char *filename, const char *mode);
```

打开文件并返回文件句柄。

- 指针（`*filename`）为文件名。使用`""`包含。

- 模式（`mode`）包括 `"r"`（读）、`"w"`（写 ）、`"a"`（追加）等。

> 上面是操作文本文件，假设是操作二进制bin文件需要使用 `"rb"`（读）、`"wb"`（写 ）、`"ab"`（追加）等。

| 模式 | 描述                                                         |
| ---- | ------------------------------------------------------------ |
| r    | 打开一个已有的文本文件，允许读取文件。如果文件不存在返回NULL，如果文件存在返回文件句柄。 |
| w    | 打开一个文本文件，允许写入文件。如果文件不存在，则会创建一个新文件。在这里，您的程序会从文件的开头写入内容。如果文件存在，文件内容会被清空（即文件长度被截断为0）。 |
| a    | 打开一个文本文件，以追加模式写入文件。如果文件不存在，则会创建一个新文件。如果文件存在则将文件指针偏移到最末尾。 |
| r+   | 打开一个文本文件，允许读写文件。                             |
| w+   | 打开一个文本文件，允许读写文件。如果文件已存在，则文件会被截断为零长度，如果文件不存在，则会创建一个新文件。 |
| a+   | 打开一个文本文件，允许读写文件。如果文件不存在，则会创建一个新文件。读取会从文件的开头开始，写入则只能是追加模式。 |

### 文件关闭 fclose

```
int fclose(FILE *stream);
```

关闭文件流，成功返回 `0`，失败返回 `EOF`。

### 文件读取 fread

```
size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream);
```

从文件读取 `nmemb` 个大小为 `size` 的数据块到缓冲区。

- ptr：读取的内容。
- size：读取的大小，单位字节。比如UTF-8编码下的中文是三个字节，这里就写三。
- nmemb：读取的次数。使用<string.h>下的strlen()函数判断，但UTF-8编码下的中文状态/3。
- stream：读取的句柄。

### 文件写入 fwrite

```c
size_t fwrite(const void *ptr, size_t size, size_t nmemb, FILE *stream);
```

- ptr：写入的内容。
- size：写入的大小，单位字节。比如UTF-8编码下的中文是三个字节，这里就写三。
- nmemb：写入的次数。使用<string.h>下的strlen()函数判断，但UTF-8编码下的中文状态/3。
- stream：写入的句柄。

将缓冲区数据写入文件。

### 文件指针偏移 fseek

```c
int fseek(FILE *stream, long offset, int whence);
```

文件指针偏移。

- stream：写入的句柄。

- offset：偏移量（字节数），可为正数、负数或零。

- whence：`whence` 可为 `SEEK_SET`（文件头）、`SEEK_CUR`（当前位置）、`SEEK_END`（文件尾）。

- 成功：返回 `0`

	失败：返回非零值（通常为 `-1`）

然后读取就是从偏移量开始的位置读取。

### 获取文件指针偏移量 ftell

```c
long ftell(FILE *stream);
```

返回当前文件位置。

- stream：写入的句柄。

- 成功：返回当前文件位置（相对于文件开头的偏移量，单位：字节）

	失败：返回 `-1L` 并设置 `errno`

### 清除文件缓存区 fflush

```c
int fflush(FILE *stream);
```

强制将缓冲区内容写入文件。若 `stream` 为 `NULL`，刷新所有打开的输出流。

> 读取或写入的内容一般是先写在内存里，结束后在写入硬盘，这个可以立即写入硬盘但不结束。



