# UEFI

### UEFI 是什么？

**UEFI**（Unified Extensible Firmware Interface，统一可扩展固件接口）是一种个人电脑的**标准**，定义了操作系统和平台固件之间的软件接口。它是传统 **BIOS** 的现代替代方案，旨在解决 BIOS 的诸多限制。

你可以将 UEFI 理解为一个功能强大得多的**微型操作系统**，它在电脑硬件和完整的操作系统（如 Windows、Linux）之间运行，负责初始化硬件并为加载操作系统做好准备。

---

### UEFI 的核心特性与优势（与传统 BIOS 对比）

UEFI 并非仅仅是 BIOS 的图形化版本，它是一种全新的底层框架。下表清晰地对比了它与传统 BIOS 的核心区别：

| 特性         | **传统 BIOS**                 | **UEFI**                                       | **优势解读**                                                 |
| :----------- | :---------------------------- | :--------------------------------------------- | :----------------------------------------------------------- |
| **操作模式** | 16位实模式                    | 32位或64位保护模式                             | UEFI 可以直接利用现代 CPU 的全部能力和内存，启动更快，代码更高效。 |
| **用户界面** | 纯文本界面，只能通过键盘操作  | **图形化界面**，支持鼠标、触摸屏、多语言       | 对用户更友好，配置硬件设置更加直观方便。                     |
| **磁盘分区** | 仅支持 **MBR**                | 原生支持 **GPT**                               | **突破 2.2TB 容量限制**，支持几乎无限大小的硬盘；**支持超过4个主分区**（最多128个）。 |
| **启动过程** | 从固定位置的 MBR 读取代码     | 从 **EFI 系统分区** 加载 **.efi** 应用程序     | **更灵活、更安全**。操作系统引导程序只是一个特殊的 `.efi` 文件，可以像普通文件一样管理。 |
| **驱动模型** | 依赖于“中断调用”的固化ROM驱动 | 拥有**模块化、可扩展的驱动**架构               | UEFI 可以在启动过程中加载独立的硬件驱动（如网络、显卡），支持**网络安装系统**、**高级故障排查**等。 |
| **安全性**   | 几乎无安全启动机制            | **Secure Boot（安全启动）**                    | 可以确保只有被信任签名的操作系统引导程序才能加载，有效防止 **Bootkit** 等 rootkit 病毒。 |
| **启动速度** | 慢，顺序初始化硬件            | 快，可以**并行初始化**硬件，并支持**启动休眠** | 显著减少开机自检和加载的时间。                               |

---

### UEFI 的核心概念详解

#### 1. GPT (GUID Partition Table)
UEFI 不再使用 BIOS 时代的 MBR 分区表，而是使用 **GPT**。
*   **容量巨大**：理论上支持最大 **18 EB**（Exabyte，约等于 10亿 GB）的磁盘。
*   **分区无限**：理论上没有分区数量限制（但操作系统会施加限制，如 Windows 最多 128 个）。
*   **更健壮**：在磁盘的首尾部分均存有分区表头信息，提供了**冗余备份**，大大降低了分区表损坏导致数据全部丢失的风险。

#### 2. EFI 系统分区 (ESP - EFI System Partition)
这是一个独立于操作系统文件系统的特殊分区，格式通常为 **FAT32**。它是 UEFI 启动过程中的核心组件。
*   **作用**：它就像 UEFI 的“工具箱”或“启动菜单”，里面存储了：
    *   **引导程序**：各个操作系统的 `.efi` 引导文件（如 `\EFI\Microsoft\Boot\bootmgfw.efi` 用于 Windows，`\EFI\ubuntu\grubx64.efi` 用于 Ubuntu）。
    *   **驱动程序**：UEFI 阶段所需的硬件驱动文件（`.efi`）。
    *   **工具程序**：系统维护工具，如 shell、诊断程序等。
*   **要求**：每个 GPT 磁盘都必须有一个 ESP 才能从该磁盘启动。

#### 3. Secure Boot (安全启动)
这是一项重要的安全功能。
*   **原理**：UEFI 固件内部存有受信任的数字证书（如微软的）。在加载任何 `.efi` 应用程序（包括操作系统引导程序）之前，UEFI 会检查其数字签名。如果签名无效或未被信任，则拒绝加载。
*   **目的**：防止恶意软件在操作系统启动之前就植入内核，从根本上杜绝了一类极其隐蔽的病毒。
*   **兼容性**：有时需要为一些未被签名的系统（如某些 Linux 发行版或硬件驱动）手动禁用 Secure Boot 或导入其证书。

---

### UEFI 的启动流程

UEFI 的启动过程比 BIOS 更简洁、更模块化：

1.  **SEC (Security Phase)**：上电初始阶段，初始化临时内存，为后续阶段准备安全环境。
2.  **PEI (Pre-EFI Initialization)**：初始化关键硬件，如 CPU、内存控制器，为执行 UEFI 驱动做准备。
3.  **DXE (Driver Execution Phase)**：**核心阶段**。加载并执行 UEFI 驱动程序（如显卡、网络、磁盘驱动），初始化所有硬件。此时，漂亮的 UEFI 图形界面就可以显示了。
4.  **BS (Boot Services)** & **RT (Runtime Services)**：启动服务为操作系统加载器提供所需的功能（如内存管理）。当操作系统完全启动后，它会接管系统控制权，UEFI 的启动服务终止，但运行时服务会保留，供操作系统在需要时调用。
5.  **OS Loader**：UEFI 固件按照启动顺序，找到 EFI 系统分区中的操作系统引导程序（`.efi` 文件）并执行它。
6.  **OS**：引导程序开始加载操作系统的内核，最终完成启动。

---

### 如何与 UEFI 交互

1.  **UEFI 设置界面**：
    *   在开机时按特定键（通常是 `Del`, `F2`, `F10`, `Esc`）即可进入。
    *   界面通常是图形化的，支持鼠标操作，可以配置启动顺序、超频设置、开启/关闭 Secure Boot 等。

2.  **UEFI Shell**：
    *   一个基于命令行的预启动环境，类似于 DOS 或 Linux shell。
    *   允许用户手动执行 `.efi` 应用程序、浏览分区、进行系统诊断和修复。对于高级用户和系统管理员非常有用。

### 总结

**UEFI 是 BIOS 的现代化、功能更强大的继承者。** 它不再是一个简单的“固件”，而是一个位于硬件和操作系统之间的**轻量级平台**。

它的主要优势体现在：
*   **更快的启动速度**
*   **支持大容量硬盘（GPT）**
*   **更强大的图形化预启动环境和安全性（Secure Boot）**
*   **模块化和可扩展的架构**

如今，几乎所有新生产的计算机都已采用 UEFI。虽然为了兼容性，大多数 UEFI 主板都提供了一个 **“Legacy BIOS”** 或 **“CSM”**（兼容性支持模块）模式来启动旧的操作系统，但未来无疑属于纯 UEFI。
