# 主引导记录 MBR

## 基本介绍

**MBR**，全称为 **Master Boot Record**，即**主引导记录**。它是一段存储在存储设备（如硬盘、U盘）最开始位置的**特殊引导代码扇区**，通常占用设备的第一个扇区（512字节）。

当电脑开机进行自检（POST）后，BIOS/UEFI固件会主动读取MBR里的信息，从而知道下一步该怎么做才能启动操作系统。

## 组成部分

这512字节的扇区虽然很小，但结构非常精巧，包含了几个关键部分：

1.  **引导代码（Bootstrap Code）**
    *   **大小**： 440 字节（前440字节）。
    *   **作用**： 这是可执行的机器代码。它的主要任务是**扫描分区表**，找到一个被标记为“活动（Active）”的主分区，然后**加载并执行该分区第一个扇区（称为卷引导记录VBR）的代码**，从而将控制权交给操作系统本身的引导程序（如Windows的NTLDR或BOOTMGR，Linux的GRUB等）。
    *   **有趣的事实**： 正因为这段代码是先于操作系统执行的，所以它也成为了一些**引导型病毒**和**MBR勒索软件**的攻击目标。

2.  **磁盘签名（Disk Signature）**
    *   **大小**： 4 字节（在440字节之后）。
    *   **作用**： 操作系统（如Windows）使用这个唯一的ID来识别磁盘。如果你克隆了一个磁盘而没有改变这个签名，操作系统可能会感到困惑。

3.  **分区表（Partition Table）**
    *   **大小**： 64 字节（紧接着磁盘签名）。
    *   **作用**： 这是MBR的**核心**。它描述了硬盘上的分区信息。由于只有64字节，它最多只能定义**4个主分区（Primary Partition）** 的记录。每个分区记录占16字节，包含了该分区的起始位置、大小、类型（如NTFS、FAT32、Linux等）以及是否为活动分区等关键信息。

4.  **结束标志（Boot Signature）**
    *   **大小**： 2 字节（最后两个字节，`0x55` 和 `0xAA`）。
    *   **作用**： 这是一个魔数（Magic Number），用于BIOS/UEFI验证这个扇区是否是一个有效的MBR。如果最后两个字节不是`55 AA`，BIOS会认为这个磁盘不可引导，并可能报错。



## 启动过程

1.  开机，BIOS/UEFI进行硬件自检。
2.  BIOS/UEFI根据预设的启动顺序，找到第一个可启动的存储设备（如硬盘）。
3.  BIOS/UEFI**读取该设备的第一个扇区（即MBR）** 到内存中。
4.  BIOS/UEFI检查MBR的结束标志是否为`55 AA`，如果是，则执行MBR中的**引导代码**。
5.  **引导代码**查看**分区表**，寻找标记为“活动（Active）”的主分区。
6.  找到活动分区后，引导代码去**加载并执行该活动分区的第一个扇区（VBR）** 中的代码。
7.  VBR中的代码继续加载操作系统的更复杂的引导程序，最终完成整个操作系统的启动。



## 局限性

随着技术的发展，MBR的一些固有缺陷逐渐暴露：

1.  **最大支持 2TB 的磁盘**： MBR使用32位字段来存储分区大小信息，这使得它最大只能支持 $2^{32} \times 512$ 字节（约 2.2TB）的磁盘。对于大于2TB的现代硬盘，无法使用全部空间。
2.  **最多只能有4个主分区**： 只有4个分区记录槽位。如果需要更多分区，必须将其中一个主分区设置为**扩展分区（Extended Partition）**，然后在扩展分区内创建多个**逻辑分区（Logical Partition）**。这种方式比较复杂且容易出问题。
3.  **可靠性较差**： MBR是**单一存储**的，分区表和引导代码都只有一个副本。如果这个扇区被损坏（比如病毒或意外写入），整个磁盘将无法读取和启动，数据恢复困难。



## MBR vs. GPT

为了解决MBR的局限性，一种更现代的分表方案被广泛采用——**GPT（GUID Partition Table）**。

| 特性             | MBR（传统）                           | GPT（现代）                                                  |
| :--------------- | :------------------------------------ | :----------------------------------------------------------- |
| **最大磁盘容量** | **~2.2 TB**                           | **近乎无限**（如9.4 ZB，1 ZB = 10亿 TB）                     |
| **分区数量**     | **4个主分区**（或3主+1扩展+无数逻辑） | **理论上无限制**（Windows限制为128个）                       |
| **可靠性**       | **差**。数据单一存储，易损坏。        | **高**。在磁盘头部和尾部均存有分区表副本，具有CRC校验，可自动修复。 |
| **兼容性**       | 所有现代操作系统都支持。              | 需要UEFI固件支持（现代电脑都具备）。在传统BIOS上通过CSM模块也可支持。 |



## 总结

*   **MBR**是一种历史悠久的磁盘分区和启动管理方案，位于磁盘的第一个扇区。
*   它的核心作用是**引导系统**和**存储分区表信息**。
*   由于其**2TB容量**和**4个主分区**的限制，它正逐渐被更先进的**GPT**方案所取代。
*   如今，在新购买的**支持UEFI的电脑**和**大于2TB的硬盘**上，**GPT是最佳且默认的选择**。而MBR则主要用于**旧系统**或**小容量存储设备**（如U盘、旧电脑硬盘）。

希望这个介绍能帮助你全面理解MBR表！
