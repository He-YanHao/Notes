# 图片格式

## 基础介绍

几乎都是先从左到右进行行扫描，扫完一行之后，再从上到下进行列扫描。

分辨率为 640*480，刷新频率为70Hz，意思是每行640像素，每列480像素，每秒扫描70次。

### 颜色表

| 颜色 |  R   |  G   |  B   |
| :--: | :--: | :--: | :--: |
|  红  | 255  |  0   |  0   |
|  蓝  |  0   |  0   | 255  |
|  绿  |  0   | 255  |  0   |
|  黄  | 255  | 255  |  0   |
|  紫  | 255  |  0   | 255  |
|  青  |  0   | 255  | 255  |
|  白  | 255  | 255  | 255  |
|  黑  |  0   |  0   |  0   |
|  灰  | 128  | 128  | 128  |

### 真彩色图

每个颜色的量级有256种，也就是1字节，3种颜色也就是3字节，加上数据排列所代表的信息，每张图片需要（像素数*3）字节的大小。

- 16位真彩色图

  使用两个字节表示颜色，其中5位用于表示红色分量（2^ 5个分量），6位用于表示绿色分量（2^ 6个分量），5位用于表示蓝色分量。因此总共可以表示2^16(即65536)种颜色。

- 24位真彩色图

  24位也就是R、G、B三个通道各占6位共18位，加上明度通道6位，所以是24位。

- 32位真彩色图

  32位是R、G、B三个通道各占8位共24位，加上明度通道8位，所以是32位，

### 调色板技术

先申请一张表，共16行，每行3个字节位，含有3个颜色的编码。然后后面某个像素点为这个颜色时只需要指明该颜色的编号即可，16种颜色也就是0.5字节，则每张图片需要（像素数\*0.5+3\*16）字节的大小。



## JPGE

JPEG 是 Joint Photographic Experts Group(联合图像专家组)的缩写，文件后辍名为“． jpg”或“． jpeg”，是最常用的图像文件格式，由一个软件开发联合会组织制定， 同 BMP 格式不同，JPEG 是一种有损压缩格式，能够将图像压缩在很小的储存空间，图像中重复或不重要的资料会被丢失，因此容易造成图像数据的损伤（BMP 不会，但是 BMP 占用空间大）。

尤其是使用过高的压缩比例，将使最终解压缩后恢复的图像质量明显降低，如果追求高品质图像，不宜采用过高压缩比例。 但是 JPEG 压缩技术十分先进，它用有损压缩方式去除冗余的图像数据，在获得极高的压缩率的同时能展现十分丰富生动的图像，换句话说，就是可以用最少的磁盘空间得到较好的图像品质。而且 JPEG 是一种很灵活的格式，具有调节图像质量的功能，允许用不同的压缩比例对文件进行压缩，支持多种压缩级别，压缩比率通常在 10： 1 到 40： 1 之间，压缩比越大，品质就越低；相反地，压缩比越小，品质就越好。比如可以把 1． 37Mb 的 BMP 位图文件压缩至 20． 3KB。当然也可以在图像质量和文件尺寸之间找到平衡点。 JPEG 格式压缩的主要是高频信息，对色彩的信息保留较好，适合应用于互联网，可减少图像的传输时间，可以支持 24bit 真彩色，也普遍应用于需要连续色调的图像。

JPEG/JPG 的解码过程可以简单的概述为如下几个部分：
1、从文件头读出文件的相关信息。JPEG 文件数据分为文件头和图像数据两大部分，其中文件头记录了图像的版本、长宽、采样因子、量化表、哈夫曼表等重要信息。所以解码前必须将文件头信息读出，以备图像数据解码过程之用。
2、从图像数据流读取一个最小编码单元(MCU) ，并提取出里边的各个颜色分量单元。
3、将颜色分量单元从数据流恢复成矩阵数据。
使用文件头给出的哈夫曼表，对分割出来的颜色分量单元进行解码，把其恢复成 8×8
的数据矩阵。
4、 8×8 的数据矩阵进一步解码。此部分解码工作以 8×8 的数据矩阵为单位， 其中包括相邻矩阵的直流系数差分解码、使用文件头给出的量化表反量化数据、反 Zig- zag 编码、隔行正负纠正、反向离散余弦变换等 5 个步骤， 最终输出仍然是一个 8×8 的数据矩阵。
5、颜色系统 YCrCb 向 RGB 转换。
将一个 MCU 的各个颜色分量单元解码结果整合起来，将图像颜色系统从 YCrCb 向
RGB 转换。
6、排列整合各个 MCU 的解码数据。
不断读取数据流中的 MCU 并对其解码，直至读完所有 MCU 为止，将各 MCU 解码后的数据正确排列成完整的图像。JPEG 的解码本身是比较复杂的， 这里 FATFS 的作者，提供了一个轻量级的 JPG/JPEG 解码库： TjpgDec，最少仅需 3KB 的 RAM 和 3.5KB 的 FLASH 即可实现 JPG/JPEG 解码，本例程采用 TjpgDec 作为 JPG/JPEG 的解码库，关于 TjpgDec 的详细使用，请参考光盘： 6，软件资料\图片编解码\TjpgDec 技术手册 这个文档。BMP 和 JPEG 这两种图片格式均不支持动态效果，而 GIF 则是可以支持动态效果。最后，我们来看看 GIF 图片格式。

## GIF

GIF(Graphics Interchange Format)是 CompuServe 公司开发的图像文件存储格式， 1987 年开发的 GIF 文件格式版本号是 GIF87a， 1989 年进行了扩充，扩充后的版本号定义为 GIF89a。GIF 图像文件以数据块(block)为单位来存储图像的相关信息。一个 GIF 文件由表示图形/图像的数据块、数据子块以及显示图形/图像的控制信息块组成，称为 GIF 数据流(Data Stream)。数据流中的所有控制信息块和数据块都必须在文件头(Header)和文件结束块(Trailer)之间。

GIF 文件格式采用了 LZW(Lempel-Ziv Walch)压缩算法来存储图像数据，定义了允许用户为图像设置背景的透明(transparency)属性。此外， GIF 文件格式可在一个文件中存放多幅彩色图形/图像。如果在 GIF 文件中存放有多幅图，它们可以像演幻灯片那样显示或者像动画那样演示。
一个 GIF 文件的结构可分为文件头(File Header)、 GIF 数据流(GIF Data Stream)和文件终结器(Trailer)三个部分。文件头包含 GIF 文件署名(Signature)和版本号(Version)； GIF 数据流由控制标识符、图象块(Image Block)和其他的一些扩展块组成；文件终结器只有一个值为 0x3B 的字符（’;’）表示文件结束。