# shell脚本逻辑

## 调试

运行 `bash -n your_script.sh`，它只检查语法错误而不执行脚本。

## 比较运算符

### 数字比较运算符

| 运算符 | 描述                        | 示例            | 说明                           |
| ------ | --------------------------- | --------------- | ------------------------------ |
| `-eq`  | 等于 (Equal)                | `[ $a -eq $b ]` | 检查两个数是否相等             |
| `-ne`  | 不等于 (Not Equal)          | `[ $a -ne $b ]` | 检查两个数是否不相等           |
| `-gt`  | 大于 (Greater Than)         | `[ $a -gt $b ]` | 检查左侧数是否大于右侧数       |
| `-ge`  | 大于等于 (Greater or Equal) | `[ $a -ge $b ]` | 检查左侧数是否大于或等于右侧数 |
| `-lt`  | 小于 (Less Than)            | `[ $a -lt $b ]` | 检查左侧数是否小于右侧数       |
| `-le`  | 小于等于 (Less or Equal)    | `[ $a -le $b ]` | 检查左侧数是否小于或等于右侧数 |

### 字符串比较运算符

| 运算符      | 描述               | 示例                | 说明                                   |
| ----------- | ------------------ | ------------------- | -------------------------------------- |
| `=` 或 `==` | 等于               | `[ "$a" = "$b" ]`   | 检查两个字符串是否相等                 |
| `!=`        | 不等于             | `[ "$a" != "$b" ]`  | 检查两个字符串是否不相等               |
| `<`         | 小于 (按字典顺序)  | `[[ "$a" < "$b" ]]` | 检查左侧字符串是否在字典顺序上小于右侧 |
| `>`         | 大于 (按字典顺序)  | `[[ "$a" > "$b" ]]` | 检查左侧字符串是否在字典顺序上大于右侧 |
| `-z`        | 长度为0 (Zero)     | `[ -z "$a" ]`       | 检查字符串是否为空                     |
| `-n`        | 长度非0 (Non-zero) | `[ -n "$a" ]`       | 检查字符串是否非空                     |

**注意**：使用 `[[ ]]` 而不是 `[ ]` 时，`<` 和 `>` 不需要转义。

### 文件测试运算符

| 运算符 | 描述                 | 示例                | 说明                         |
| ------ | -------------------- | ------------------- | ---------------------------- |
| `-e`   | 存在 (Exists)        | `[ -e "file" ]`     | 检查文件或目录是否存在       |
| `-f`   | 是普通文件 (File)    | `[ -f "file" ]`     | 检查路径是否存在且是普通文件 |
| `-d`   | 是目录 (Directory)   | `[ -d "dir" ]`      | 检查路径是否存在且是目录     |
| `-s`   | 大小大于0 (Size)     | `[ -s "file" ]`     | 检查文件是否存在且大小大于0  |
| `-r`   | 可读 (Readable)      | `[ -r "file" ]`     | 检查文件是否可读             |
| `-w`   | 可写 (Writable)      | `[ -w "file" ]`     | 检查文件是否可写             |
| `-x`   | 可执行 (eXecutable)  | `[ -x "file" ]`     | 检查文件是否可执行           |
| `-L`   | 是符号链接 (Link)    | `[ -L "file" ]`     | 检查文件是否是符号链接       |
| `-nt`  | 比...新 (Newer Than) | `[ "f1" -nt "f2" ]` | 检查f1是否比f2新             |
| `-ot`  | 比...旧 (Older Than) | `[ "f1" -ot "f2" ]` | 检查f1是否比f2旧             |

### 注意事项

**空格很重要**：在 `[ ]` 内部，运算符和操作数之间必须有空格

- 正确：`[ $a -eq $b ]`
- 错误：`[$a-eq$b]`

**引用变量**：对于字符串比较，最好将变量用双引号括起来，防止空变量或含空格变量导致错误

- 推荐：`[ "$a" = "$b" ]`
- 不推荐：`[ $a = $b ]`

**两种测试语法**：

- 传统 test 命令：`[ condition ]`
- Bash 扩展：`[[ condition ]]`（支持更多运算符且不需要转义某些符号）

**算术比较的替代方法**：在 `(( ))` 中可以使用更熟悉的比较运算符

```bash
if (( a == b )); then  # 注意这里使用 == 而不是 -eq
  echo "a 等于 b"
fi
```



## 逻辑判断写法

### test

`test` 是一个用于检查文件类型、比较值和字符串的 Shell 内置命令。它根据评估的条件返回退出状态：

- **退出状态 0**：表示条件为真（true）
- **退出状态 1**：表示条件为假（false）

这使得它非常适合与 `if`、`while` 和 `until` 等流程控制语句结合使用。

### []

方括号 `[ ]` 实际上是 `test` 命令的另一种形式，`[` 是一个命令，后面必须有一个空格，并且以 `]` 结束。

### [[]]

`[[ ]]` 是 `[ ]` 的增强版，支持更多运算符（如模式匹配 `==`、正则匹配 `=~`），并且更安全。

## 逻辑运算符

&&（“和”）

||（“或”）

## if条件判断

### 基础格式

```shell
if [ condition ]; then
    # 条件为真时执行的命令
fi
```

`then` 将条件测试部分与要执行的动作部分分开，是 Shell 语法结构的要求。

`fi` 是 Shell 脚本中条件判断结构的结束标记，它表示 `if` 条件语句的终止。

或者写成：

```shell
if [ condition ]
then
    # 条件为真时执行的命令
fi
```

`then` 单独一行可以不加 `;`

### 带else形式

```bash
if [ condition ]; then
    # 条件为真时执行的命令
else
    # 条件为假时执行的命令
fi
```

### 带elif形式

```bash
if [ condition1 ]; then
    # 条件1为真时执行
elif [ condition2 ]; then
    # 条件2为真时执行
else
    # 所有条件都为假时执行
fi
```



## for循环

### 遍历值列表

```bash
for variable in item1 item2 item3 ... itemN
do
    # 循环体
    commands
done
```

- for：for循环的开始
- variable：循环变量，每次迭代时会被赋值为列表中的一个元素。
- in：关键字，分隔循环变量和要遍历的列表。
- itemN：要遍历的值列表，可以是任何以空格分隔的值。
- do：表示循环体的开始，它必须与后面的 `done` 配对使用。
- done：for循环的结束。

#### 使用通配符

```shell
for file in *.txt
do
    echo "Processing: $file"
    wc -l "$file"
done
```

**执行过程**：

1. Shell 首先扩展 `*.txt`，生成匹配的文件列表（如 `file1.txt file2.txt report.txt`）
2. 然后对每个文件执行循环体中的命令

#### 列表生成方式

列表可以通过多种方式生成：

- 显式列出：`for i in 1 2 3 4 5`
- 大括号扩展：`for i in {1..5}`
- 命令替换：`for file in $(ls *.txt)`
- 数组扩展：`for item in "${array[@]}"`
- 通配符扩展：`for file in *.log`

### 遍历命令输出

```bash
for variable in $(command)
do
    # 循环体
    commands
done
```

先执行 `$(command)`（命令替换），获取命令的标准输出。

再将结果分割后依次赋给 `variable` 。

### C 语言风格（Bash 扩展）

```bash
for ((initialization; condition; increment))
do
    # 循环体
    commands
done
```

- initialization：初始化部分，在循环开始前执行一次。
- condition：在每次迭代前检查
    - 如果条件为真（非零），则执行循环体
    - 如果条件为假（零），则退出循环
- increment：在每次迭代后执行，可以执行多个操作。

### C语言适配

C语言的for循环 `break` 的跳出循环 和 `continue` 的跳出本次循环对于shell的for循环适配。

## while循环

### 基础格式

```shell
while [[ condition ]]
do
    # 循环体
    commands
done
```

- while：while循环开始。
- [[ condition ]]：条件判断，[]写法也行。
    - 若为真则执行循环体
    - 若为假则结束while循环
- do：分割条件判断和循环体。
- done：while循环结束。

while循环也可以使用 continue 和 break。



















