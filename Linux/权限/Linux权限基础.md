# Linux权限基础

## 基础介绍

使用 ` ls -l ` 命令可以得到一串信息，截取第一行为：

```shell
drwxr-xr-x 2 he he 4096 10月14日 11:51 公共
```

前十个字母代表的含义分别是：

```shell
d        rwx           r-x            r-x
文件属性  文件属主       文件属组         其他用户的读取写入执行权限
目录文件  可读可写可执行  可读不可写可执行   可读不可写可执行
```

文件属性分为：

- ` - ` ：普通文件。
- ` d ` ：目录文件。
- ` l ` ：符号链接。
  - 符号连接文件的权限都是虚设的，实际权限时指向的文件。
- ` c ` ：字符设备文件。
- ` b ` ：块设备文件。

读取写入执行权限分为：

| 权限 | 若为文件               | 若为目录         |
| ---- | ---------------------- | ---------------- |
| r    | 允许打开并读取文件     | 允许列出目录内容 |
| w    | 允许写入或截取文件     | 允许重命名或删除 |
| x    | 允许该文件作为程序执行 | 允许进入该目录   |
| s    | 以文件拥有者的身份运行 |                  |





## 设置默认权限

使用umask命令设置默认权限。





## 改变文件权限chmod

**作用**：用于更改文件或目录的**访问权限**。它决定了谁可以**读**、**写**或**执行**这个文件。

**基本语法**：

```bash
chmod [选项] 权限模式 文件或目录
```

**权限的表示**：

### 数字表示法（八进制模式）

使用 3 个数字分别代表**所有者**、**所属组**和**其他用户**的权限。每个数字是以下三个权限值的总和：

| 权限 |  值  | 含义           |
| :--- | :--: | :------------- |
| r    |  4   | 读 (Read)      |
| w    |  2   | 写 (Write)     |
| x    |  1   | 执行 (eXecute) |
| -    |  0   | 无权限         |

- 按照 **读 写 执行** 的顺序排列，有权限视为 1，无权限为 0，转化为八进制，如：07为0b111，意为可读可写可执行。

- 然后按照 **用户属主 用户属组 其他用户** 的顺序排列。

    如：` chmod 764 文件路径/文件名 ` 意为：用户属主可读可写可执行，用户属组可读可写不可执行，其他用户可读不可写不可执行。

**示例**：

*   `7` = 4 + 2 + 1 (rwx)：读、写、执行全部权限
*   `6` = 4 + 2 (rw-)：读和写权限
*   `5` = 4 + 1 (r-x)：读和执行权限
*   `4` = 4 (r--)：只读权限
*   `0` = 0 (---)：无任何权限

**常见用法**：

1.  `chmod 755 file`：
    *   所有者：`7` (rwx) - 可读、写、执行
    *   所属组：`5` (r-x) - 可读、执行
    *   其他用户：`5` (r-x) - 可读、执行
    *   **说明**：这是脚本、程序和目录最常用的权限，所有者可完全控制，其他人只能读和执行。

2.  `chmod 644 file`：
    *   所有者：`6` (rw-) - 可读、写
    *   所属组：`4` (r--) - 只读
    *   其他用户：`4` (r--) - 只读
    *   **说明**：这是普通文件（如文本、图片）的标准权限，所有者可编辑，其他人只能查看。

3.  `chmod 600 file`：
    *   所有者：`6` (rw-) - 可读、写
    *   所属组：`0` (---) - 无权限
    *   其他用户：`0` (---) - 无权限
    *   **说明**：非常私密的文件（如SSH私钥 `id_rsa`），只有所有者自己能读写。

### 符号表示法

使用符号来添加或移除权限。

*   **用户类别**：

    - 首先是影响对象

        | 符号 | 全称  | 含义     |
        | ---- | ----- | -------- |
        | u    | user  | 用户属主 |
        | g    | group | 用户属组 |
        | o    | other | 其他用户 |
        | a    | all   | 全部     |

*   **操作符**：

    *   `+`：添加权限
    *   `-`：移除权限
    *   `=`：精确设置权限

*   **权限**：

    *   `r`：读
    *   `w`：写
    *   `x`：执行

**示例**：

1.  **为所有用户添加执行权限**：

    ```bash
    chmod a+x script.sh
    # 等价于 chmod ugo+x script.sh
    chmod +x script.sh
    # 等价于 chmod a+x script.sh
    # +x 等同于 a+x，为所以用户添加执行权限。
    ```

2.  **移除所属组和其他用户的写权限**：

    ```bash
    chmod go-w document.txt
    ```

3.  **精确设置权限**：将所属组的权限设置为*只读*。

    ```bash
    chmod g=r data.csv
    ```

**常用选项**：

*   `-R`：递归更改目录及其内容的所有权限。

    ```bash
    sudo chmod -R 755 /opt/myapp/
    ```

*   `-v`：显示详细信息。



## 改变文件所有者和所属组chown

**作用**：用于更改文件或目录的**所有者**（Owner）和**所属组**（Group）。

**基本语法**：

```bash
chown [选项] [新所有者][:新所属组] 文件或目录
```

**关键概念**：
*   **所有者**：文件的主人，通常是创建它的用户。
*   **所属组**：文件所属的用户组，用于为一组用户设置权限。

**常用选项**：
*   `-R` 或 `--recursive`：递归地更改指定目录及其内部所有文件和子目录的所有者/组。这是最常用的选项之一。
*   `-v` 或 `--verbose`：显示命令执行的详细操作。

**使用示例**：
1.  **更改文件的所有者**：
    将文件 `file.txt` 的所有者改为用户 `zhangsan`。
    ```bash
    sudo chown zhangsan file.txt
    ```

2.  **同时更改所有者和所属组**：
    将文件 `file.txt` 的所有者改为 `zhangsan`，所属组改为组 `developers`。
    ```bash
    sudo chown zhangsan:developers file.txt
    ```

3.  **只更改文件的所属组**：
    将文件 `file.txt` 的所属组改为组 `www-data`。
    ```bash
    sudo chown :www-data file.txt
    # 或者使用 chgrp 命令（专门改组的命令）:
    sudo chgrp www-data file.txt
    ```

4.  **递归更改目录的所有权**：
    将目录 `/var/www/html` 及其内部所有内容的所有者改为 `www-data`，组也改为 `www-data`。这在部署网站时非常常见。
    ```bash
    sudo chown -R www-data:www-data /var/www/html
    ```

**注意**：普通用户不能将自己的文件所有权随便给其他人，通常需要使用 `sudo` 来获取 root 权限执行此命令。



## root权限

可以通过 ` su -参数 用户 ` 。如果不指定参数则默认为 ` -l ` 将工作目录切换到目标用户的家目录；如果不指定用户则默认为root用户；

进入root用户后工作目录自动切换为 `/root ` ，同时打开新的终端。

也可以使用 ` sudo ` 命令行使部分root权限，但不开启新的终端。



