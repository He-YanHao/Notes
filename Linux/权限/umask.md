# umask



**umask**（全称：**user file-creation mask**，用户文件创建掩码）是一个用于**控制新创建文件和目录的默认权限**的命令。它是一个掩码，决定了哪些权限位应该在创建时被“屏蔽”或“禁止”。

简单来说，系统有一个默认的“最大权限”，而 `umask` 的作用就是从最大权限中“减去”指定的权限，从而得到文件和目录最终的默认权限。

*   文件的默认最大权限：`666` （即 `rw-rw-rw-`，读、写）
*   目录的默认最大权限：`777` （即 `rwxrwxrwx`，读、写、执行）

---

### 语法与查看当前 umask

**语法：**
```bash
umask [选项] [模式]
```

**查看当前 umask 值：**
直接输入 `umask` 即可。
```bash
umask
```
输出通常有两种格式：
*   **符号格式** (例如：`u=rwx,g=rwx,o=rx`)
*   **数字（八进制）格式** (例如：`022`)。**这是最常用和最重要的格式。**

---

### 工作原理（数字格式如何计算）

数字格式的 `umask` 通常是一个三位或四位的八进制数（如 `022`, `0022`），我们重点关注后三位。

**计算新文件的默认权限：**
**文件最终权限 = 默认最大权限 (666) - umask 值**

**计算新目录的默认权限：**
**目录最终权限 = 默认最大权限 (777) - umask 值**

**注意：** 这只是一个便于理解的简化模型。在二进制层面，它实际上是进行一个“与”操作（`&`）：`最终权限 = 最大权限 & (~umask)`。但对于大多数用户来说，用“减法”来理解就足够了。

#### 举例说明 (umask = 022)

这是最常见、最标准的 `umask` 值。

1.  **对于文件：**
    *   最大权限： `666` (`rw-rw-rw-`)
    *   减去 umask： `- 022` (`----w--w-`)
    *   最终权限： `644` (`rw-r--r--`)

    结果：文件所有者可读可写，所属组和其他用户只可读。

2.  **对于目录：**
    *   最大权限： `777` (`rwxrwxrwx`)
    *   减去 umask： `- 022` (`----w--w-`)
    *   最终权限： `755` (`rwxr-xr-x`)

    结果：目录所有者可读、写、进入，所属组和其他用户可读、进入。

#### 另一个例子 (umask = 002)

这种 `umask` 常用于协作性强的开发环境，同一组的成员可以互相修改文件。

1.  **对于文件：**
    *   `666 - 002 = 664` (`rw-rw-r--`)
    *   结果：所有者和所属组都可读可写，其他用户只读。

2.  **对于目录：**
    *   `777 - 002 = 775` (`rwxrwxr-x`)
    *   结果：所有者和所属组都可读、写、进入，其他用户可读、进入。

---

### 如何设置 umask

#### 1. 临时设置 (仅对当前 Shell 会话有效)
直接在终端中设置新的值即可。
```bash
umask 022   # 设置为022
umask 002   # 设置为002
```

#### 2. 永久设置 (对所有未来会话生效)
要永久生效，需要将 `umask` 命令写入你的 shell 的配置文件中。

*   **对于 Bash 用户**：编辑 `~/.bashrc` 文件
*   **对于 Zsh 用户**：编辑 `~/.zshrc` 文件
*   **对于 Fish 用户**：使用 `fish_config` 或编辑 `~/.config/fish/config.fish`，添加 `umask 022`。从你提供的 `env` 输出看，你使用的是 Fish Shell。

在配置文件的末尾添加一行：
```bash
umask 022
```
然后保存文件，并**重启终端**或运行 `source ~/.bashrc`（或其他对应的配置文件）使其立即在当前终端生效。

*   **系统全局设置**：如果需要为所有用户设置，可以修改 `/etc/profile` 或 `/etc/bash.bashrc` 等文件（需要 root 权限）。

---

### 常用 umask 值与含义

| umask 值         | 文件权限            | 目录权限            | 安全性 | 适用场景                                             |
| :--------------- | :------------------ | :------------------ | :----- | :--------------------------------------------------- |
| **022** (最常见) | `644` (`rw-r--r--`) | `755` (`rwxr-xr-x`) | 较高   | **默认推荐值**。用户私有，其他人只能读。             |
| **002**          | `664` (`rw-rw-r--`) | `775` (`rwxrwxr-x`) | 一般   | **团队协作**。同组用户可以编辑文件和目录。           |
| **000**          | `666` (`rw-rw-rw-`) | `777` (`rwxrwxrwx`) | 很低   | 完全不设防，任何用户都可修改。**极其危险，不推荐。** |
| **077**          | `600` (`rw-------`) | `700` (`rwx------`) | 很高   | **高度私有**。只有文件所有者自己可以访问。           |

---

### 总结与注意事项

1.  **核心作用**：`umask` 决定了新创建文件和目录的**初始访问权限**。
2.  **权限计算**：记住 `666` 和 `777` 这两个最大权限，用“减法”理解即可。
3.  **安全重要**：设置一个过于宽松的 `umask`（如 `000`）是重大的安全风险，因为它允许任何用户修改或删除你的文件。
4.  **目录 vs 文件**：系统会自动为目录赋予执行权限（`x`），这样才能进入它。
5.  **永久生效**：记得修改 shell 的配置文件（如 `~/.bashrc`）才能使设置永久保留。

通过合理配置 `umask`，你可以有效地管理系统的安全性和文件共享的便利性。对于个人桌面系统，`022` 是一个安全且通用的选择。
