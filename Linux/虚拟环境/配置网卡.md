# 虚拟机网卡配置

仅包含自动桥接模式的虚拟机

```
he@he-books:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:3d:67:9f brd ff:ff:ff:ff:ff:ff
    altname enp2s1
    inet 192.168.182.120/24 brd 192.168.182.255 scope global dynamic noprefixroute ens33
       valid_lft 3585sec preferred_lft 3585sec
    inet6 240e:47e:3279:19f:e2a9:f354:52c7:4cd4/64 scope global temporary dynamic 
       valid_lft 7197sec preferred_lft 7197sec
    inet6 240e:47e:3279:19f:dc99:fda3:c8c7:d340/64 scope global dynamic mngtmpaddr noprefixroute 
       valid_lft 7197sec preferred_lft 7197sec
    inet6 fe80::1ce5:eb8d:582b:10fc/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
```



## 配置仅主机网卡

增加仅主机模式后

```
he@he-books:~$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:3d:67:9f brd ff:ff:ff:ff:ff:ff
    altname enp2s1
    inet 192.168.182.120/24 brd 192.168.182.255 scope global dynamic noprefixroute ens33
       valid_lft 3579sec preferred_lft 3579sec
    inet6 240e:47e:3279:19f:9159:c80e:756d:88d9/64 scope global temporary dynamic 
       valid_lft 7180sec preferred_lft 7180sec
    inet6 240e:47e:3279:19f:dc99:fda3:c8c7:d340/64 scope global dynamic mngtmpaddr noprefixroute 
       valid_lft 7180sec preferred_lft 7180sec
    inet6 fe80::1ce5:eb8d:582b:10fc/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
3: ens37: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 00:0c:29:3d:67:a9 brd ff:ff:ff:ff:ff:ff
    altname enp2s5
    inet6 fe80::57fa:1f38:ec03:f655/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever

he@he-books:/etc/netplan$ nmcli device status
DEVICE  TYPE      STATE                   CONNECTION         
ens33   ethernet  connected               Wired connection 1 
lo      loopback  connected (externally)  lo                 
ens37   ethernet  disconnected            --
```

**Ubuntu 24.04.3 LTS** 使用了 **NetworkManager** 来管理网络.

并且 `ens37` 接口的状态是 `disconnected`，这意味着当前该接口没有连接到任何网络。

可以使用 `nmcli` 命令来为 `ens37` 配置静态 IP 地址。

配置静态 IP 地址步骤：

1.  **为 `ens37` 设置静态 IP 地址**：
    使用以下命令配置静态 IP 地址，例如将 `ens37` 配置为 `192.168.232.168`，子网掩码为 `255.255.255.0`，网关为 `192.168.232.1`，并设置 DNS 服务器为 `8.8.8.8` 和 `114.114.114.114`。

    首先列出当前的所有连接，看看是否已经为 `ens37` 创建了一个连接：

    ```
    he@he-books:/etc/netplan$ nmcli connection show
    NAME                UUID                                  TYPE      DEVICE 
    Wired connection 1  92aa9450-199e-3f31-8631-696e96630e35  ethernet  ens33  
    Wired connection 2  03b6aa0d-9bf4-3102-a42d-0488f3afff54  ethernet  ens37  
    lo                  17b7d292-62eb-42f6-836e-7e93df0ae2ff  loopback  lo   
    ```

    如果有，就使用：

    ```
    sudo nmcli con mod "Wired connection 2" ipv4.addresses 192.168.232.168/24
    sudo nmcli con mod "Wired connection 2" ipv4.gateway 192.168.232.1
    sudo nmcli con mod "Wired connection 2" ipv4.dns "8.8.8.8 114.114.114.114"
    sudo nmcli con mod "Wired connection 2" ipv4.method manual
    ```

    直接用下面的配置方法无效。

    ```bash
    sudo nmcli con mod ens37 ipv4.addresses 192.168.232.168/24
    sudo nmcli con mod ens37 ipv4.gateway 192.168.232.1
    sudo nmcli con mod ens37 ipv4.dns "8.8.8.8 114.114.114.114"
    sudo nmcli con mod ens37 ipv4.method manual
    ```

    这些命令的作用是：

    -   `ipv4.addresses` 设置 `ens37` 的静态 IP 地址。
    -   `ipv4.gateway` 设置默认网关。
    -   `ipv4.dns` 设置 DNS 服务器。
    -   `ipv4.method manual` 将连接方法设置为手动（即使用静态 IP，而不是自动通过 DHCP 获取）。

2.  **启动 `ens37` 网络连接**：
    使用以下命令启动 `ens37` 接口的网络连接：

    ```
    sudo nmcli con up "Wired connection 2"
    ```

    ```bash
    sudo nmcli con up ens37
    ```

3.  **验证配置是否生效**：
    检查 `ens37` 是否成功获取了静态 IP 地址：

    ```bash
    ip a
    ```

    或者使用 `nmcli` 查看连接状态：

    ```bash
    nmcli device status
    ```

    确保 `ens37` 的状态是 `connected`，并且 IP 地址是你设置的静态 IP 地址。

