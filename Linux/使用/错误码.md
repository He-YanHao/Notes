# Linux系统常见错误码详解

Linux系统中的错误码对于系统管理和故障排查非常重要。以下是常见的错误码分类和详细说明：

## 📋 错误码快速查询表

| 错误码 | 名称      | 描述             | 常见场景     |
| ------ | --------- | ---------------- | ------------ |
| **1**  | EPERM     | 操作不允许       | 权限不足     |
| **2**  | ENOENT    | 文件或目录不存在 | 路径错误     |
| **13** | EACCES    | 权限拒绝         | 文件权限问题 |
| **17** | EEXIST    | 文件已存在       | 创建重复文件 |
| **28** | ENOSPC    | 设备无剩余空间   | 磁盘已满     |
| **39** | ENOTEMPTY | 目录非空         | 删除非空目录 |

## 🔧 系统调用错误码（部分）

### 文件系统相关错误
- **EPERM (1)** - 操作不允许
- **ENOENT (2)** - 文件或目录不存在
- **EIO (5)** - I/O错误
- **EBADF (9)** - 错误的文件描述符
- **EACCES (13)** - 权限拒绝
- **EEXIST (17)** - 文件已存在
- **ENOTDIR (20)** - 不是目录
- **EISDIR (21)** - 是目录
- **EINVAL (22)** - 无效参数
- **ENOSPC (28)** - 设备无剩余空间
- **EROFS (30)** - 只读文件系统
- **ENOTEMPTY (39)** - 目录非空

### 内存和进程相关错误
- **ENOMEM (12)** - 内存不足
- **EAGAIN (11)** - 资源暂时不可用
- **ECHILD (10)** - 无子进程
- **ESRCH (3)** - 进程不存在

### 网络相关错误
- **ECONNREFUSED (111)** - 连接被拒绝
- **ETIMEDOUT (110)** - 连接超时
- **ENETUNREACH (101)** - 网络不可达
- **EHOSTUNREACH (113)** - 主机不可达

## 🔍 查看错误码的方法

### 1. 使用perror命令
```bash
# 查看错误码含义
perror 2
# 输出：OS error code   2:  No such file or directory

perror 13
# 输出：OS error code  13:  Permission denied
```

### 2. 使用errno命令
```bash
# 安装errno工具
sudo apt install moreutils

# 查看所有错误码
errno -l

# 搜索特定错误
errno search permission
```

### 3. 编程中获取错误信息
```c
#include <stdio.h>
#include <errno.h>
#include <string.h>

// 示例：获取错误描述
printf("Error: %s\n", strerror(errno));
perror("Error message");
```

## 🛠️ 常见错误排查示例

### 权限错误 (EACCES - 13)
```bash
# 错误示例
$ touch /root/test.txt
touch: cannot touch '/root/test.txt': Permission denied

# 解决方法
sudo touch /root/test.txt
# 或修改权限
chmod 755 /path/to/file
```

### 文件不存在 (ENOENT - 2)
```bash
# 错误示例
$ cat /nonexistent/file
cat: /nonexistent/file: No such file or directory

# 解决方法
ls -la /path/to/check_exists
mkdir -p /path/to/directory
```

### 磁盘空间不足 (ENOSPC - 28)
```bash
# 错误示例
$ dd if=/dev/zero of=test.txt bs=1G count=10
dd: error writing 'test.txt': No space left on device

# 检查磁盘空间
df -h
# 清理空间
sudo apt autoremove
sudo journalctl --vacuum-size=100M
```

### 目录非空 (ENOTEMPTY - 39)
```bash
# 错误示例
$ rmdir /nonempty/directory
rmdir: failed to remove '/nonempty/directory': Directory not empty

# 解决方法
rm -rf /nonempty/directory
# 或逐个删除内容
find /nonempty/directory -delete
```

## 📊 系统状态错误码

### 服务管理错误
```bash
# 检查服务状态
systemctl status service-name

# 常见状态码
# 0 - 成功
# 1 - 通用错误
# 2 - 误用shell命令
# 126 - 命令不可执行
# 127 - 命令未找到
# 128 - 无效退出参数
# 130 - 被Ctrl+C终止
# 137 - 被KILL信号终止
```

### 包管理错误
```bash
# dpkg错误码
# 0 - 操作成功
# 1 - 一般错误
# 2 - 致命错误
```

## 🔧 高级错误处理技巧

### 1. 错误码转换
```bash
# 在脚本中处理错误
if ! command; then
    echo "Error code: $?"
    case $? in
        1) echo "General error" ;;
        2) echo "No such file" ;;
        13) echo "Permission denied" ;;
        *) echo "Unknown error" ;;
    esac
fi
```

### 2. 调试脚本
```bash
#!/bin/bash
# 启用错误跟踪
set -e  # 遇到错误立即退出
set -u  # 使用未定义变量时报错
set -o pipefail  # 管道中任意命令失败则整个管道失败

# 或者使用trap捕获错误
trap 'echo "Error at line $LINENO"; exit 1' ERR
```

### 3. 系统日志分析
```bash
# 查看系统日志中的错误
journalctl -p err -b  # 本次启动的错误
journalctl --since "1 hour ago" | grep -i error
dmesg | grep -i error  # 内核错误信息
```

## 💡 实用命令总结

```bash
# 快速错误码查询
errno 13
perror 2

# 系统状态检查
df -h  # 磁盘空间
free -h  # 内存使用
systemctl --failed  # 失败的服务

# 日志分析
journalctl -f  # 实时日志
tail -f /var/log/syslog  # 系统日志
```

掌握这些错误码能够帮助您快速定位和解决Linux系统中的问题。在实际使用中，结合系统日志和错误码信息，可以大大提高故障排查的效率。
