# IAP

## 简介

程序以二进制的形式顺序存在单片机Flash里，若Flash够大，一次存放两套运行程序，根据需求可以进行切换，这就是IAP。

常见的有存放程序0和存放程序x，开机后运行存放程序0，并判断是否需要升级存放程序x。若是，则通过某种通讯协议获取存放程序x二进制并更新，然后转到程序x；若否，跳过。运行程序x。

第一个项目代码称之为Bootloader程序，第二个项目代码称之为APP程序。

## STM初始化流程

STM32F4系列Flash初始地址为0X08000000，程序在这里开始写入。根据ARM-4内核，要先加载中断向量表。

所以写入流程为：

1. 写入中断向量表。
2. 写入程序。
3. 若中断，跳转中断向量表对应位置。
4. 执行中断。
5. 回到main。

若有IAP则为：

1. 写入Bootloader程序的中断向量表。
2. 运行IAP程序。
3. 写入APP程序的中断向量表。
4. 写入程序。
5. 若中断，跳转Bootloader程序的中断向量表对应位置，再跳转APP程序的中断向量表对应位置。
6. 执行中断。
7. 回到main。



