### 数据结构

USB使用差分信号，包含：

- J状态（对应逻辑0）：D+ 高，D- 低
- K状态（对应逻辑1）：D+低，D- 高
- SE0 状态：D+ 低，D- 低
- Reset信号：同时拉低D+&D-超过10ms，还原USB为未配置状态。



USB采用NRZI编码方式，当数据为 0 时电平反转，为 1 时不反转。

遵循位填充规则，六位一填充。

USB发送流程：USB终端将数据进行位填充之后，使用SIE将数据串行化和NRZI编码后发送到USB的差分线上。

USB接收流程：采样数据线，将数据并行化后去掉位填充，恢复原来的数据。



USB数据的基本单位是 包 。

- 包
    - 同步域：数据传输即将开始。
        - 低速/全速 设备为 7 个 0  和一个 1。
        - 高速设备是 31 个 0  和一个 1。
    - 包标识符：用于标记包的类型。共八位（PID0~PID7），前四位为数据位（PID0~PID3），后四位（PID4~PID7）取反作为校验。
        - 令牌包：PID1~PID0 为 01。
            - 0b 00 01：将要输出数据。
            - 0b 01 01：帧起始数据包。
            - 0b 10 01：将要输入数据。
            - 0b 11 01：开始一个控制传输。
        - 数据包：PID1~PID0 为 11。
            - 0b 00 11：不同类型的数据包。
            - 0b 01 11：不同类型的数据包。
            - 0b 10 11：不同类型的数据包。
            - 0b 11 11：不同类型的数据包。
        - 握手包：PID1~PID0 为 10。
            - 0b 00 10：确定。
            - 0b 01 10：未准备好。
            - 0b 10 10：不确定。
            - 0b 11 10：挂起。
        - 特殊包：PID1~PID0 为 00。
            - 0b 00 00：保留，未使用。
            - 0b 01 00：PING测试（令牌包）。
            - 0b 10 00：分裂事务（令牌包）。
            - 0b 11 00：作为令牌包的时候是前导。
            - 0b 11 00：作为握手包的时候是错误。
    - 包结束符：
        - 低速/全速 设备为 两个数据宽度的 SE0 。
        - 高速设备 为 故意的位填充错误。



令牌包。USB是主从结构，仅能主机发送数据，从机接收数据。

- 输出：将要输出一个数据包。
- 输入：让从机返回一个数据包。
- 建立：
- 帧起始：


