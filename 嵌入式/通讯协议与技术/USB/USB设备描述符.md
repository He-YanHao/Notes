# USB设备描述符



USB设备描述符（USB Device Descriptor）是USB设备在与主机通信时提供的关键信息之一，用于描述USB设备的基本信息。每个USB设备都必须至少提供一个设备描述符，设备描述符的内容包括设备类型、设备功能、支持的USB协议版本等。它是USB设备在USB总线中被识别和初始化的关键。

### 设备描述符的结构

设备描述符是一个固定格式的数据块，通常由以下字段组成：

1.  **bLength**
    -   类型：1字节
    -   描述：描述符的长度。设备描述符的固定长度是18字节，故此字段值通常为0x12。
2.  **bDescriptorType**
    -   类型：1字节
    -   描述：描述符的类型。对于设备描述符，其值为`0x01`。
3.  **bcdUSB**
    -   类型：2字节
    -   描述：支持的USB版本。USB 2.0的值为`0x0200`，USB 3.0的值为`0x0300`。
4.  **bDeviceClass**
    -   类型：1字节
    -   描述：设备的类别代码。这个字段指示了设备属于哪个类别（如音频、通信、存储等）。如果设备使用接口来定义功能，则此字段为`0x00`，表示不定义设备类。
5.  **bDeviceSubClass**
    -   类型：1字节
    -   描述：设备子类代码，表示设备的子类。如果设备类别是`0x00`（没有设备类），此字段无效。
6.  **bDeviceProtocol**
    -   类型：1字节
    -   描述：设备协议代码，表示设备使用的协议。若设备不指定协议，则此字段通常为`0x00`。
7.  **bMaxPacketSize0**
    -   类型：1字节
    -   描述：设备端点0的最大包大小，表示在控制传输中，设备端点0一次可以传输的最大数据量。常见值是`0x40`，即64字节。
8.  **idVendor**
    -   类型：2字节
    -   描述：设备厂商的ID。这个值由USB-IF（USB实施论坛）分配，每个厂商都有一个唯一的ID。
9.  **idProduct**
    -   类型：2字节
    -   描述：设备的产品ID。厂商分配，用于唯一标识某一款产品。
10.  **bcdDevice**
     -   类型：2字节
     -   描述：设备的版本号。通常用高字节表示主版本号，低字节表示次版本号。
11.  **iManufacturer**
     -   类型：1字节
     -   描述：制造商字符串的索引。此字段指向一个字符串描述符，该字符串描述了设备的制造商。
12.  **iProduct**
     -   类型：1字节
     -   描述：产品字符串的索引。指向一个描述符，描述设备的名称或型号。
13.  **iSerialNumber**
     -   类型：1字节
     -   描述：序列号字符串的索引。如果设备有序列号，这个字段会指向一个包含设备唯一序列号的字符串描述符。
14.  **bNumConfigurations**
     -   类型：1字节
     -   描述：设备的配置数量。设备可以有多个配置，每个配置可以提供不同的设备功能。

### 示例

一个典型的USB设备描述符可能如下所示（假设为USB 2.0设备）：

```
bLength = 0x12
bDescriptorType = 0x01
bcdUSB = 0x0200
bDeviceClass = 0x00
bDeviceSubClass = 0x00
bDeviceProtocol = 0x00
bMaxPacketSize0 = 0x40
idVendor = 0x1234
idProduct = 0x5678
bcdDevice = 0x0100
iManufacturer = 0x01
iProduct = 0x02
iSerialNumber = 0x03
bNumConfigurations = 0x01
```

### 作用

USB设备描述符为主机提供了有关设备的关键信息，以便进行适当的设备识别、配置和数据交换。USB主机根据设备描述符中的信息来初始化和配置设备，从而进行后续的通讯。



