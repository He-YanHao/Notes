# STM32-bxCAN

## CAN模式

- 工作模式
  - 初始化模式：错误访问某些配置寄存器可能会导致硬件暂时性地干扰整个 CAN 网络，所以仅在该模式可以配置CAN。
  - 正常模式：正常工作，CAN大部分时间在此状态。
  - 睡眠模式（低功耗）

- 测试模式
  - 静默模式：仅可发送隐性位，无法干涉CAN总线上的数据（如果必须有显性位则由内部改道发送）。
  - 环回模式：将其自身发送的消息作为接收的消息来处理并存储（如果这些消息通过了验收筛选）  在接收邮箱中。
  - 环回与静默组合模式：二者结合，既可以自检，又不会干涉总线。
  - 调试模式：较为复杂。

## STM32F1寄存器

| 寄存器       | 描述                                 | 说明                        |
| ------------ | ------------------------------------ | --------------------------- |
| CAN_MCR      | 主控制寄存器                         | 修改此寄存器更改CAN模式     |
| CAN_MSR      | 主状态寄存器                         | 读取此寄存器获取当前CAN模式 |
| CAN_TSR      | 发送状态寄存器                       |                             |
| CAN_RF0R     | 接收 FIFO 0 寄存器                   |                             |
| CAN_RF1R     | 接收 FIFO 1 寄存器                   |                             |
| CAN_IER      | CAN 中断允许寄存器                   |                             |
| CAN_ESR      | CAN 错误状态寄存器                   |                             |
| CAN_BTR      | CAN 位时间特性寄存器                 |                             |
| TIR          | 发送邮箱标识符寄存器                 |                             |
| TDTR         | 发送邮箱数据长度和时间戳寄存器       |                             |
| TDLR         | 发送邮箱低字节数据寄存器             |                             |
| TDHR         | 发送邮箱高字节数据寄存器             |                             |
| RIR          | 接收 FIFO 邮箱标识符寄存器           |                             |
| RDTR         | 接收 FIFO 邮箱数据长度和时间戳寄存器 |                             |
| RDLR         | 接收 FIFO 邮箱低字节数据寄存器       |                             |
| RDHR         | 接收 FIFO 邮箱高字节数据寄存器       |                             |
| CAN_FMR      | CAN 过滤器主控寄存器                 |                             |
| CAN_FM0R     | CAN 过滤器模式寄存器                 |                             |
| CAN_FSC0R    | CAN 过滤器位宽寄存器                 |                             |
| CAN_FFA0R    | CAN 过滤器                           |                             |
| FIFO         | 关联寄存器                           |                             |
| CAN_FA0R CAN | 过滤器激活寄存器                     |                             |
| CAN_FR0      | 过滤器组 0 寄存器                    |                             |
| CAN_FR1      | 过滤器组 1 寄存器                    |                             |