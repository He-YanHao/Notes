## CAN时钟

CAN总线没有时钟线，总线上的所有设备通过约定波特率的方式确定每一个数据位的时长。

为了灵活调整每个采样点的位置，使采样点对齐数据位中心附近，CAN总线对每一个数据位的时长进行了更细的划分，分为：

- 同步段（SS）
- 传播时间段 （PTS）
- 相位缓冲段1（PBS1）
- ***在相位缓冲段1 & 相位缓冲段2 之间采集数据。***
- 相位缓冲段2（PBS2）

每个段又由若干个最小时间单位（Tq）构成。

**硬同步：**

- 每个设备都有一个位时序计时周期，当某个设备（发送方）率先发送报文， 其他所有设备（接收方）收到SOF的下降沿时，接收方会将自己的位时序计时周期拨到SS段的位置，与发送方的位时序计时周期保持同步。

- 硬同步只在帧的第一个下降沿（SOF下降沿）有效。

- 经过硬同步后，若发送方和接收方的时钟没有误差，则后续所有数据位的采样点必然都会对齐数据位中心附近。

**再同步：**

- 若发送方或接收方的时钟有误差，随着误差积累，数据位边沿逐渐偏离SS段， 则此时接收方根据再同步补偿宽度值（SJW）通过加长PBS1段，或缩短PBS2 段，以调整同步。

- 再同步可以发生在第一个下降沿之后的每个数据位跳变边沿。

波特率 = 1 / 一个数据位的时长 = 1 / (**T**SS + **T**PTS + **T**PBS1 + **T**PBS2)。

例如： SS = 1Tq，PTS = 3Tq，PBS1 = 3Tq，PBS2 = 3Tq Tq = 0.5us。

波特率 = 1 / (0.5us + 1.5us + 1.5us + 1.5us) = 200kbps。
