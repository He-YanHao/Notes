# 嵌入式C

## C语言规范和习惯

- TAB键缩进不同软件规范不一样，所以可以统一用空格代替，四个或八个空格代替一个TAB。

  可以在设置里设定为缩进替换为四个或八个空格字符。

- 指针*放在靠近变量名的一侧。

- 关键词后面加空格。

- 常量宏和枚举统一使用大写。

- 一般函数命名均为小写，专有名词例外，如：OLED LCD。

文件信息注释

```c
/**
  ****************************************************************************************************
  *@标题    
  *@版本    
  *@时间    
  ****************************************************************************************************
  *@说明
  *
  *
  ****************************************************************************************************
  */

```

函数注释

```c
/**
  *@函数作用    
  *@参数1    
  *@参数2    
  *@返回值    
  */
```

注意：

- 写清每一个变量的作用，注意取值范围，避免下面的错误情况。

  ```c
  for(uint8_t i = 0, i < 1000, i++)
  {
  	循环语句；
  }
  ```




## 位操作

指定位清零

```
int a = 0b 0100 1100;//将第三位清零
a &= 0b 1111 1011;//利用与运算都为1的时候结果为1的特点，赋值第三位为0，则结果第三位必为0，其他位为1，则可以保留其他位。
//结果为 a == 0b 0100 1000;
```

指定位赋值

```
int a = 0b 0100 1100;//将第二位赋值
a |= 0b 0000 0010;//利用或运算有一个是1结果就为1的特点，赋值第二位为1，则结果第二位为1，其他位为0则其他位保留。
//结果为 a == 0b 0100 1110;
```

按位移动

```
a = a << 1 << 1;//将a按位向左移动2位
```

```
a = a << 1 << 2;//运算顺序为{a = [(a << 1) << 2]};所以是向左移动三位
```

先清空这两位，然后再往这两位里面写值。操作为**GPIOB_MODER** &= 0xffffffcf; 这句代码是清空第5位和第4位。**GPIOB_MODER** |= 0x00000010;这句代码就是把第5位和第4位配置为01，这样操作保证了其它位不发生变化。



## 指针

```C
/* GPIOA 端口的16个引脚全部输出高电平 */
*(unsigned int*)(0x40020014) = 0xFFFF;
```

说明：

(unsigned int*)的作用是将0x40020014这个立即数强制类型转化为无符号整形地址，告诉编译器这是一个地址。

\*(unsigned int*)(0x40020014) = 0xFFFF;就是相当于对0x40020014这个内存空间赋值为0xFFFF。

给每个地址都起一个名字，则为：

```c
/* GPIOA 端口的16个引脚全部输出高电平 */
#define GPIOA_ODR *(unsigned int*)(0x40020014)
GPIOA_ODR = 0xFFFF;
```



## typedef

32单片机规范中使用 ` int8_t ` 代替 ` char ` 使用 ` uint8_t ` 代替 ` unsigned char ` ，其余 ` int `  ` long `  ` long long ` 同理。（使用了C语言中的关键字 ` typedef ` 来给变量类型进行改名。）

结构体除了可以使用 ` A.B `外还可以使用 ` pA->B ` 来直接访问地址。

## 结构体

```
typedef struct 
{ 
        __IO uint32_t CRL; 
        __IO uint32_t CRH; 
        … 
} GPIO_TypeDef; 
```

理解为：通过struct申请名为GPIO_TypeDef的结构体，成员包含uint32_t类型的CRL和uint32_t类型的CRH，并用typedef修饰，使得接下来可以直接使用GPIO_TypeDef申请该结构体。

> 这里似乎是一个C语言标准，若创建结构体变量的时候没有使用typedef，则接下来申请结构体变量的时候需要加上typedef，如果是C++，则无此限制。

结构体指针成员变量引用方法是通过`->`符号实现。

## 外部申明

C语言中extern可以置于变量或者函数前，以表示变量或者函数的定义在别的文件中，提示编译器遇到此变量和函数时在其他模块中寻找其定义。

这里面要注意，对于extern申明变量可以多次，但定义只有一次。

在我们的代码中你会看到这样的语句：`extern uint16_t g_usart_rx_sta;`这个语句是申明`g_usart_rx_sta`变量在其他文件中已经定义了，在这里要使用到。所以，你肯定可以找到在某个地方有变量定义的语句：  `uint16_t g_usart_rx_sta;`extern的使用比较简单，但是也会经常用到，需要掌握。





