# TCP头

## 核心作用
TCP头是附加在数据包前的控制信息，如同一个详细的“包裹单”，确保数据能**可靠、有序、不丢不重**地送达。它为实现TCP协议的核心功能（连接管理、可靠性、流量控制、拥塞控制）提供了必要的信息。



## 结构
一个标准的TCP头通常为**20字节**（不含选项字段），其结构由以下字段构成：

| 字段名         | 长度   | 作用说明                                                     |
| :------------- | :----- | :----------------------------------------------------------- |
| **源端口号**   | 16位   | 标识发送数据包的应用程序。                                   |
| **目的端口号** | 16位   | 标识接收数据包的应用程序。**IP地址+端口号共同唯一标识一个连接。** |
| **序列号**     | 32位   | **本报文段所发送数据的第一个字节的编号**。用于解决**乱序**问题（接收方按此序号重组数据）。 |
| **确认号**     | 32位   | **期望收到对方下一个报文段的第一个数据字节的序号**。同时表示该序号之前的所有数据已正确接收。用于**确认**和**可靠性**。 |
| **数据偏移**   | 4位    | 指出TCP头部长度（以4字节为单位），从而确定数据部分的起始位置。 |
| **保留字段**   | 6位    | 保留为未来使用，必须设为0。                                  |
| **控制位**     | 6位    | 每位代表一个控制功能（如下表）。                             |
| **窗口大小**   | 16位   | **用于流量控制**。指示本报文段接收方还能接收多少字节的数据。 |
| **校验和**     | 16位   | 用于校验TCP头部和数据在传输中是否出错。                      |
| **紧急指针**   | 16位   | 仅当**URG=1**时有效，指出本报文段中紧急数据的末尾位置。      |
| **选项**       | 可变长 | 可选字段，用于支持一些高级功能（如最大报文段长度MSS、窗口缩放因子等）。 |
| **填充**       | 可变长 | 确保TCP头部长度是4字节的整数倍。                             |



## 控制位（Flags）
这是TCP头的“灵魂”，每个标志位占1比特，置1表示有效。

| 标志位  | 名称 | 作用                                                         |
| :------ | :--- | :----------------------------------------------------------- |
| **URG** | 紧急 | 表示报文段中有紧急数据，应尽快传送。                         |
| **ACK** | 确认 | **置1表示【确认号】字段有效**。建立连接后，绝大多数报文都置位ACK。 |
| **PSH** | 推送 | 提示接收端应用程序应立即从TCP缓冲区读走数据。                |
| **RST** | 复位 | **置1表示要求释放并重新建立连接**。用于处理异常或拒绝连接。  |
| **SYN** | 同步 | **在建立连接时使用，用于同步序列号**。`SYN=1, ACK=0` 表示连接请求；`SYN=1, ACK=1` 表示同意建立连接。 |
| **FIN** | 终止 | **置1表示数据已发送完毕，要求释放连接**。                    |



## 总结
TCP头是一个设计精妙的控制结构，它通过**端口号**确定应用，通过**序列号和确认号**保障可靠性与有序性，通过**标志位**管理连接状态，通过**窗口大小**实现流量控制。所有这些字段协同工作，共同构筑了TCP协议这座“可靠数据传输”大厦的基石。





