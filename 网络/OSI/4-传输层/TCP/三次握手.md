三次握手（Three-Way Handshake）是 **TCP 建立连接的过程**，用于在通信双方之间建立一个可靠的连接。

------

# 一句话理解

> 三次握手的目的是：
> 确认双方都具备发送和接收数据的能力，并同步初始序列号。

------

# 三次握手过程

假设：

- 客户端（Client）
- 服务器（Server）

------

## 第一次握手

客户端 → 服务器

发送：

```
SYN = 1
seq = x
```

含义：

- 请求建立连接
- 告诉服务器：我的初始序列号是 x

此时客户端状态：

```
SYN_SENT
```

------

## 第二次握手

服务器 → 客户端

发送：

```
SYN = 1
ACK = 1
seq = y
ack = x + 1
```

含义：

- 同意建立连接
- 确认收到客户端的 SYN
- 告诉客户端：我的初始序列号是 y

此时服务器状态：

```
SYN_RCVD
```

------

## 第三次握手

客户端 → 服务器

发送：

```
ACK = 1
ack = y + 1
```

含义：

- 确认收到服务器的 SYN

此时：

客户端状态：

```
ESTABLISHED
```

服务器收到 ACK 后：

```
ESTABLISHED
```

连接建立完成。

------

# 为什么必须三次？

核心原因：

> 双方都要确认“发送能力”和“接收能力”是正常的。

### 两次不行吗？

如果只有两次：

服务器无法确认客户端是否能接收数据。

三次握手可以保证：

- 客户端发送正常
- 服务器接收正常
- 服务器发送正常
- 客户端接收正常

------

# 简单类比

像打电话：

1️⃣ 你：喂？
2️⃣ 对方：听到了，你能听到我吗？
3️⃣ 你：能听到

然后正式通话。

------

# 三次握手的作用

- 建立连接
- 同步初始序列号
- 协商窗口大小
- 协商 MSS 等参数

------

# 总结

> 三次握手是 TCP 建立可靠连接的过程，通过 SYN 和 ACK 交换，确保双方通信能力正常并同步序列号。

------

如果你愿意，我可以继续讲：

- 为什么不能两次？
- SYN Flood 是怎么攻击的？
- 抓包怎么看三次握手？
- 嵌入式 lwIP 中三次握手的状态变化？

你想深入哪部分？



## 三次握手

通过控制位可以看到TCP头如何工作：

1.  **客户端发送**：`[SYN=1, Seq=J]` （我想和你连接，我初始序列号是J）
2.  **服务器回复**：`[SYN=1, ACK=1, Seq=K, Ack=J+1]` （我同意连接，我序列号是K，确认收到了你的J）
3.  **客户端确认**：`[ACK=1, Seq=J+1, Ack=K+1]` （好的，连接已建立）

