# 网络基础

## 基本网络概念

### IP地址
是设备在网络上的唯一标识。分为两种：
*   **IPv4**： 由32位二进制数组成，通常分成4个8位组，每组转换成十进制数，并用点号`.`分隔。例如 `192.168.1.1`。地址总量有限，几乎已经耗尽。
*   **IPv6**： 由8组16进制的数字组成，例如 `2001:0db8:85a3::8a2e:0370:7334`。地址空间巨大，是未来的趋势。

家里的电脑、手机通常获取到的是 `192.168.x.x` 或 `10.x.x.x` 这样的**内网IP**（私有IP），这是路由器帮你分配的。而整个家庭网络共用一个对外的**公网IP**（由运营商分配），路由器负责在内外网之间转换（这个过程叫NAT）。



#### IP地址的组成与分类

以IPv4为例，一个IP地址包含两部分信息：**网络号** 和 **主机号**。

- **网络号**： 标识设备属于**哪一个网络**。就像地址中的“城市和街道”部分，所有在同一街道的设备共享相同的网络号。
- **主机号**： 在指定的网络中**唯一标识那台设备**。就像地址中的“门牌号”。



### 子网掩码

如何区分一个IP地址中哪部分是网络号，哪部分是主机号？这就要靠**子网掩码**。

- **子网掩码**： 它是一串类似IP地址的数字（如 `255.255.255.0`），它的作用就是**指明IP地址中网络号的位数**。
    - `255` 对应的二进制是 `11111111`（8个1），表示这8位是网络号。
    - `0` 表示这8位是主机号。
    - 所以，对于IP地址 `192.168.1.100` 和子网掩码 `255.255.255.0`：
        - 网络号是：`192.168.1`
        - 主机号是：`100`



### 端口

一台设备（一个IP地址）上可能运行着很多网络程序，比如同时开着浏览器、微信、游戏。
*   IP地址把数据送到设备，端口号则指定交给设备上的哪个应用程序。
*   端口范围是 0-65535。
*   **常见端口**：
    *   **80**： HTTP协议（网页浏览）
    *   **443**： HTTPS协议（加密的网页浏览）
    *   **21**： FTP协议（文件传输）
    *   **25**： SMTP协议（发送邮件）
    *   **3306**： MySQL数据库

**IP地址 + 端口号** 就构成了一个完整的“送达地址”，在网络术语中叫 **Socket**。

### 协议
协议就是网络通信中的**规则和约定**，就像道路交通规则一样，规定了数据应该如何打包、如何发送、如何接收。
*   **TCP协议**： **传输控制协议**。像**打电话**，需要先建立连接，可靠传输。保证数据不丢失、不重复、按顺序到达。用于网页浏览、邮件、文件传输等要求高的场景。
*   **UDP协议**： **用户数据报协议**。像**发短信或广播**，不需要建立连接，直接发送。速度快，但不保证数据一定到达或按顺序到达。用于视频通话、在线游戏、直播等实时性要求高的场景。



### TCP/IP五层模型

为了简化网络设计的复杂性，专家们采用了“分层”的思想。最著名的两个模型是OSI七层模型和TCP/IP五层（或四层）模型。我们常用更实用的**TCP/IP五层模型**来理解。

| 分层              | 功能                               | 常见协议/设备               |
| ----------------- | ---------------------------------- | --------------------------- |
| **5. 应用层**     | 为用户提供应用服务                 | HTTP, HTTPS, FTP, DNS, SMTP |
| **4. 传输层**     | 负责数据分割和端到端传输           | **TCP, UDP**                |
| **3. 网络层**     | 负责地址管理和路由选择             | **IP协议，路由器**          |
| **2. 数据链路层** | 负责设备之间的数据帧传输和差错检测 | 交换机，网卡，以太网        |
| **1. 物理层**     | 负责光/电信号的传输                | 网线，光纤，无线电波        |



### MAC地址

**MAC** 的全称是 **Media Access Control Address**，中文是**媒体访问控制地址**。

它是一个被**烧录**在网络设备（如网卡、Wi-Fi模块、路由器接口）硬件中的地址。

**全球唯一**： 理论上，每一个网络设备的MAC地址在全世界都是唯一的。这是由IEEE组织统一分配和管理，制造商从IEEE购买地址块，然后分配给自己的产品。

**长度**： 它是一个48位（6字节）的二进制数，通常用12个16进制数表示，为了方便阅读，常用冒号`:`或连字符`-`分隔。

- 例如： `00:1A:2B:3C:4D:5E` 或 `00-1A-2B-3C-4D-5E`



#### MAC地址的组成结构

这12位16进制数并非随机生成，它有其内在结构：`XX:XX:XX:YY:YY:YY`

- **前6位（前3个字节）**： **OUI**
    - 称为**组织唯一标识符**。
    - 它标识了生产这个网络设备的**制造商**。
    - 例如，`00:1A:2B` 可能对应着某一家特定的公司（如诺基亚）。你可以通过OUI查询工具来查找制造商。
- **后6位（后3个字节）**： **NIC**
    - 称为**网络接口控制器标识符**。
    - 由制造商自由分配，确保自己生产的每个设备的这后6位都是唯一的。

**举个例子：**
MAC地址 `00:1A:2B:3C:4D:5E`

- `00:1A:2B` 代表这是“诺基亚公司”生产的设备。
- `3C:4D:5E` 代表这是华为生产的第某个特定的网卡。

## 一次数据包的旅程

描述一个数据包从用户设备到谷歌服务器的旅程：

1. **起源（用户设备）**：
    - 用户在浏览器输入 `www.google.com`。
    - 操作系统调用DNS解析器，通过DNS协议获得谷歌的IP地址（如 `142.251.42.206`）。
    - 浏览器发起HTTP请求，TCP/IP协议栈将数据打包。传输层加上TCP头（包含源端口、目的端口443），网络层加上IP头（包含源IP `192.168.1.100` 和目的IP `142.251.42.206`）。
2. **第一站（家庭路由器）**：
    - 数据包到达家庭路由器。
    - 路由器执行**NAT**：将IP头中的源IP从私有地址 `192.168.1.100` 替换为路由器的公网IP `101.202.96.15`，并记录此连接。
    - 路由器查询**路由表**，决定将数据包发送给ISP的下一跳路由器。
3. **穿越互联网**：
    - 数据包经过多个AS（如本地ISP、省级ISP、骨干网运营商）。
    - 每个AS边界上的**路由器**都运行**BGP**协议，它们根据路由表决策，将数据包一跳一跳地转发给离目的IP（谷歌）更近的网络。
4. **目的地（谷歌数据中心）**：
    - 数据包到达谷歌的服务器。
    - 服务器处理请求，生成响应数据包，目标地址是 `101.202.96.15`（你的路由器）。
    - 响应数据包沿另一条路径返回。
5. **返回（家庭路由器）**：
    - 路由器收到响应数据包，根据之前NAT的记录，将目标IP地址转换回 `192.168.1.100`，并转发给正确的设备。
6. **终结（用户设备）**：
    - 设备收到数据包，TCP/IP协议栈逐层解包，将数据交给浏览器。
    - 浏览器渲染页面，展示给用户。

这个旅程完美体现了 **设备 -> IPv4/IPv6 -> 路由器 -> 互联网 -> 路由器 -> IPv4/IPv6 -> 设备** 的完整闭环，清晰地展示了所有组件如何协同工作。









## 数据发送过程中的转化

就像寄快递，从上到下，每经过一层就打包一次。

1.  应用层产生原始数据（“你好”）。
2.  传输层加上TCP头（打包成“中文包裹”）。
3.  网络层加上IP头（写上收件人地址）。
4.  数据链路层加上帧头帧尾（装进货车车厢）。
5.  物理层转换成比特流（货车开上公路）。

**数据接收的过程**： 相反，从下到上，拆开一层层的包装，最终得到数据。



## 关键技术与服务

### DNS域名解析系统
IP地址很难记，所以我们用域名（如 `www.google.com`）来访问网站。**DNS就像网络世界的电话簿**，它负责把你输入的域名翻译成对应的IP地址。

**访问网站的过程**：
1.  你在浏览器输入 `www.google.com`。
2.  浏览器问DNS服务器：“`www.google.com` 的IP是多少？”
3.  DNS服务器回答：“是 `142.251.42.206`。”
4.  浏览器向 `142.251.42.206` 的80/443端口发起HTTP/HTTPS请求。
5.  服务器返回网页数据，浏览器渲染显示给你。



### DHCP动态主机配置协议

你不需要手动为手机、电脑设置IP地址，就是因为有DHCP。**DHCP就像小区的物业管理员**，当新设备连入网络时，它会自动为其分配一个可用的IP地址、子网掩码和网关地址。



### 防火墙

网络世界的**保安**。它根据预设的规则，控制哪些数据可以进出网络，用于保护网络安全，阻挡恶意攻击和未经授权的访问。





## 局域网LAN

英文是 **Local Area Network**

### 局域网的关键组件

要组建一个典型的局域网，通常需要以下设备：

| 设备           | 角色与作用             |                                                              |
| -------------- | ---------------------- | ------------------------------------------------------------ |
| **终端设备**   | 网络服务的使用者       | 电脑、手机、打印机、智能电视等                               |
| **网卡**       | 设备接入网络的**接口** | 每台设备都需要一个有唯一MAC地址的网卡                        |
| **传输介质**   | 数据传输的**物理通道** | 网线、光纤、无线电波-WiFi                                    |
| **交换机**     | **局域网的核心**       | 负责连接所有设备，智能地将数据转发给**指定的**目标设备。它工作在数据链路层，识别MAC地址。 |
| **路由器**     | **局域网对外的网关**   | 连接局域网和互联网（广域网），实现不同网络之间的通信。它负责IP地址分配（DHCP）和网络地址转换（NAT）。 |
| **无线接入点** | **提供Wi-Fi信号**      | 通常被集成在无线路由器中                                     |

**重要提示**： 在大多数家庭网络中，你看到的那个“无线路由器”，其实是一个集成了**路由器**、**交换机**（通常有4个LAN口）、**无线接入点**和**防火墙**功能的复合设备。



## 以太网

### 以太网的关键组件

**网线**： 物理传输介质。常见的有：

- **双绞线**： 最常见的就是**水晶头+8芯网线**（如Cat5e、Cat6、Cat6A、Cat7）。数字越大，版本越新，支持的带宽和速率越高。
- **光纤**： 用于长距离、高速率连接（如数据中心）。

**网络接口卡**： 也叫**网卡**。每台需要接入有线网络的设备都必须配备。它负责处理以太网协议的发送和接收，并拥有唯一的MAC地址。

**交换机**： **以太网局域网的核心**。它取代了老式的集线器，能够智能地根据MAC地址转发数据，极大地提升了网络效率和安全性。

**RJ-45接口**： 就是我们俗称的**水晶头**，是网线末端的标准插头。






