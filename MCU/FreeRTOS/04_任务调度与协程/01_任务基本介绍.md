# 任务基本介绍

## 被调度的任务函数介绍

FreeRTOS任务要求

1. 必须为无限循环（除非任务自删）。
2. 任务优先级数值越大优先级越高。
3. 堆栈大小需根据任务复杂度（局部变量、函数调用深度）动态调整。

```c
void task(void *pvParameters)
{
	//任务函数
	while(1);//在此停住
}
```

```c
void task(void *pvParameters)
{
	while(1)//{}内无限循环
	{
		//任务函数
	}
}
```

```c
void task(void *pvParameters)
{
    //任务函数
	for( ; ; )//{}内无限循环
	{
	}
}
```

其中 `*pvParameters` 为参数。



## 任务状态

任务可以存在于以下状态中：

-   **运行**

    当任务实际执行时，它被称为处于运行状态。任务当前正在使用处理器。 如果运行 RTOS 的处理器只有一个内核， 那么在任何给定时间内都只能有一个任务处于运行状态。

-   **准备就绪**

    准备就绪任务指那些能够执行（它们不处于阻塞或挂起状态）， 但目前没有执行的任务， 因为同等或更高优先级的不同任务已经处于运行状态。

-   **阻塞**

    如果任务当前正在等待时间或外部事件，则该任务被认为处于阻塞状态。 例如，如果一个任务调用vTaskDelay()，它将被阻塞（被置于阻塞状态）， 直到延迟结束——一个时间事件。 任务也可以通过阻塞来等待队列、信号量、事件组、通知或信号量 事件。处于阻塞状态的任务通常有一个"超时"期， 超时后任务将被超时，并被解除阻塞， 即使该任务所等待的事件没有发生。“阻塞”状态下的任务不使用任何处理时间，不能 被选择进入运行状态。

-   **挂起**

    与“阻塞”状态下的任务一样， “挂起”状态下的任务不能 被选择进入运行状态，但处于挂起状态的任务 没有超时。相反，任务只有在分别通过 vTaskSuspend() 和 xTaskResume() API 调用明确命令时才会进入或退出挂起状态。



## 任务优先级

每个任务均被分配了从 0 到 ( configMAX_PRIORITIES - 1 ) 的优先级，其中 configMAX_PRIORITIES 定义为 FreeRTOSConfig.h。

如果正在使用的移植实现了使用“前导零计数”类指令的移植优化任务选择机制 （针对单一指令中的任务选择）而且 configUSE_PORT_OPTIMISED_TASK_SELECTION 在 FreeRTOSConfig.h 中设置为 1，则 configMAX_PRIORITIES 无法高于 32。在其他所有情况下， configMAX_PRIORITIES 可以取任何合理数值——但为了保证 RAM 的使用效率，应取 实际需要的最小值。

优先级数字小表示任务优先级低。空闲任务的优先级为零 (tskIDLE_PRIORITY)。

FreeRTOS 调度器可确保在就绪或运行状态下的任务始终 比同样处于就绪状态下的更低优先级任务先获得处理器 (CPU) 时间。 换句话来说，处于运行状态的任务始终是能够运行的最高优先级任务。

处于相同优先级的任务数量不限。如果 configUSE_TIME_SLICING 未经定义，或者如果 configUSE_TIME_SLICING 设置为 1，则具有相同优先级的若干就绪状态任务将 通过时间切片轮询调度方案共享可用的处理时间。



## 空闲任务

当 RTOS 调度程序启动时，会自动创建空闲任务，以确保始终至少有一个能够运行的任务。它以尽可能低的优先级创建，以确保如果有更高优先级的应用程序任务处于就绪状态，它不会使用任何 CPU 时间。

空闲任务负责释放RTOS 分配给已删除的任务的内存。因此，这在以下应用程序中很重要使用 `vTaskDelete()`函数来确保空闲任务不会耗尽处理时间。空闲任务没有其他活动功能，因此在所有情况下都可以合法地耗尽微控制器时间其他条件。

应用程序任务可以共享空闲任务优先级 （tskIDLE_PRIORITY）。


