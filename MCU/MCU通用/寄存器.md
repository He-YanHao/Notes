# 寄存器

寄存器作为一种具有特殊作用的内存单元，同时起到多种作用。

STM32是一个32位的单片机，它的地址范围为2的32次方，也就是4GB的地址空间。

为了降低不同客户在相同应用时的软件复杂度，存储映射是按Cortex-M4处理器提供的规则预先定义的。在存储器映射表中，一部分地址空间由Arm Cortex-M4的系统外设所占用，且不可更改。其余部分地址空间可由芯片供应商定义使用。

寄存器是具有特定功能的内存单元，通过操作这些内存单元可以驱动外设工作。寄存器按功能又可分为指令寄存器、地址寄存器和数据寄存器，处理器可以使用相互独立的总线来读取指令和加载/存储数据。

程序存储器，数据存储器，寄存器和I / O端口都在同一个线性的4GB的地址空间之内。每一个寄存器都对应不同的功能，操作相应的寄存器就可以配置不同的功能。如果我们要控制某个外设工作，那我们可以找到这个单元的起始地址，然后通过c语言指针的方式来访问这些内存单元。但通常我们会给这个特殊的内存单元取一个名字，这个给已经分配好地址的有特定功能的内存单元取别名的过程就叫寄存器映射，这个别名就是我们所说的寄存器。

给寄存器再分配一个地址的过程叫做寄存器重映射。

片上外设区域分为三条总线，分别为AHB1总线、APB1总线和APB2总线。AHB总线最高时钟可达168MHZ，APB1总线最高时钟可达42MHZ，APB2总线时钟最高可达84MHZ。根据外设速度的不同，不同的总线挂载着不同的外设。总线的最低地址我们称为该总线的基地址，总线基地址也是挂载在该总线上的首个外设的地址。



## 如何访问寄存器

1. 通过绝对地址访问内存单元

```Plaintext
/* GPIOA 端口的16个引脚全部输出高电平 */

*(unsigned int*)(0x40020014) = 0xFFFF;
```

> (unsigned int*)的作用是将0x40020014这个立即数强制类型转化为无符号整形地址，告诉编译器这是一个地址。
>
> *(unsigned int*)是相当于*地址，也就是对这个地址对应的内存空间的值，*(unsigned int*)(0x40020014) = 0xFFFF;就是相当于对0x40020014这个内存空间赋值为0xFFFF。

2. 通过别名访问内存单元

通过上面的方式确实可以对寄存器地址进行操作，但是操作起来很麻烦，用户也不能清晰的明白这个地址对应的功能。如果我们给每个地址都起一个名字，这样看到名字是不是就知道这个地址对应什么功能了呢。

```Plaintext
/* GPIOA 端口的16个引脚全部输出高电平 */
#define GPIOA_ODR  (unsigned int*)(0x40020014)
*GPIOA_ODR = 0xFFFF;
```

或者为了方便我们干脆将*和地址写到一个，如下。

```Plaintext
/* GPIOA 端口的16个引脚全部输出高电平 */
#define GPIOA_ODR *(unsigned int*)(0x40020014)
GPIOA_ODR = 0xFFFF;
```