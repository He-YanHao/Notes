# SD卡寄存器

## 寄存器基本介绍

SD卡总共有8个寄存器，用于设定或表示SD卡信息。

| 寄存器  | 描述                                         | 长度    | 作用定位                                                     | 访问命令         |
| ------- | -------------------------------------------- | ------- | ------------------------------------------------------------ | ---------------- |
| **CID** | 卡识别号 Card Identification                 | 128 bit | 卡的唯一识别信息，包含厂商ID、产品型号、序列号等。           | CMD2             |
| **CSD** | 卡的特定数据 Card Specific Data              | 128 bit | 卡的特定数据，包括卡的容量、支持的功能（如最大块大小）等信息。 | CMD9             |
| **SCR** | SD配置寄存器 SD Configuration Register       | 64 bit  | SD卡配置寄存器，包含关于 SD 卡的功能特性，如总线宽度（1-bit / 4-bit）、支持的安全特性等。 | CMD55 + ACMD51   |
| **OCR** | 操作条件寄存器 Operation Conditions Register | 32 bit  | 包含卡的工作电压范围、上电状态、电池电压信息等。             | CMD58            |
| **SSR** | SD状态 SD Status                             | 512 bit | 包含卡的当前状态信息，如擦除状态、安全状态、性能信息等。     | CMD55 + ACMD13   |
| **RCA** | 相对地址 Relative Card Address               | 16 bit  | 相对地址，卡的本地系统地址。在卡初始化过程中，动态地由卡，SD卡会动态分配这个地址，经过主机核准后主机会使用这个地址来选择特定的卡。 | CMD3             |
| **DSR** | 驱动级寄存器 Driver Stage Register           | 16 bit  | 配置卡的驱动能力，通常用于调整卡的输出驱动电流等，但在实际应用中少有操作。 | CMD4             |
| **CS**  | 卡状态 Card Status                           | 32 bit  | 卡的状态，包含命令执行状态、错误标志、当前状态机的状态等信息。 | 所有命令的R1响应 |



## OCR寄存器

**OCR寄存器结构：**

OCR是一个**32位寄存器**，具体位定义如下：

```text
31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9  8  7  6  5  4  3  2  1  0
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
└──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┘

位31: 卡上电状态 (Busy)
位30: 卡容量状态 (CCS)
位23-15: 电压窗口
位7-0: 保留
```

**详细位说明：**

**位31 - 卡上电状态 (Card Power Up Status)**

-   **功能**：指示卡是否完成上电初始化过程
-   **状态**：
    -   `0` = 卡正在初始化（忙状态）
    -   `1` = 卡初始化完成，可以接受命令
-   **重要性**：主机必须等待此位变为1才能继续后续操作

**位30 - 卡容量状态 (Card Capacity Status)**

-   **功能**：指示SD卡容量类型
-   **状态**：
    -   `0` = 标准容量SD卡 (SDSC, ≤2GB)，使用字节寻址
    -   `1` = 高容量SD卡 (SDHC, 2GB-32GB) 或扩展容量卡 (SDXC, 32GB-2TB)，使用块寻址
-   **影响**：决定了后续读写操作的寻址方式

**位23-15 - 电压窗口 (Voltage Window)**

每个位代表一个特定的电压范围：

| 位置     | 位15     | 位16     | 位17     | 位18     | 位19     | 位20     | 位21     | 位22     | 位23     | 位24     | 位25     | 位26     | 位27     | 位28     | 位29     | 位30     |
| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 电压范围 | 2.0-2.1V | 2.1-2.2V | 2.2-2.3V | 2.3-2.4V | 2.4-2.5V | 2.5-2.6V | 2.6-2.7V | 2.7-2.8V | 2.8-2.9V | 2.9-3.0V | 3.0-3.1V | 3.1-3.2V | 3.2-3.3V | 3.3-3.4V | 3.4-3.5V | 3.5-3.6V |
| 说明     | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 |





## CID寄存器

只读寄存器，使用 CMD2 获取。

内容结构：

| 字段 | 位宽 | 说明     |
| ---- | ---- | -------- |
| MID  | 8    | 厂商 ID  |
| OID  | 16   | OEM      |
| PNM  | 40   | 产品名   |
| PRV  | 8    | 版本     |
| PSN  | 32   | 序列号   |
| MDT  | 12   | 生产日期 |
| CRC  | 7    | CRC 校验 |

用途：

-   调试打印
-   区分卡厂商
-   不参与初始化决策



## CSD寄存器

使用 CMD9 获取

SDSC类型卡对应**CSD v1.0**

SDHC / SDXC 类型卡对应**CSD v2.0**

**解析方式完全不同**

用于

-   计算 **容量**
-   最大读写速度
-   块长度支持

SDHC / SDXC 容量计算

```
容量 = (C_SIZE + 1) × 512 KB
```



## RCA寄存器

**获取方式**：`CMD3`

**由卡分配（SD 模式）**



-   多卡总线区分
-   后续命令全部使用 RCA

```
CMD7 → Select Card (使用 RCA)
```



## SCR寄存器

基本信息

-   **长度**：64 bit
-   **获取方式**：
    -   `CMD55` + `ACMD51`
-   **通过数据线读取**

------

核心字段

| 字段      | 作用           |
| --------- | -------------- |
| SD_SPEC   | SD 版本        |
| BUS_WIDTH | 是否支持 4-bit |
| SECURITY  | 安全特性       |

**是否能切 4-bit 总线，就看 SCR**



## SSR寄存器

基本信息

-   **长度**：512 bit（64 字节）
-   **获取方式**：
    -   `CMD55` + `ACMD13`

工程用途

-   当前总线宽度
-   写保护状态
-   性能信息

**主要用于诊断，不是初始化必需**


