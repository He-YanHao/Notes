# 差分对

## 什么是差分对

**差分对**是一对**长度相等、宽度相等、紧密并行布设**的PCB走线，用于传输两个**相位相反、幅度相同**的信号。

*   **一个信号** 我们称之为 **正相端**，通常标记为 `P` 或 `+`（如 `D+`）。
*   **另一个信号** 我们称之为 **反相端**，通常标记为 `N` 或 `-`（如 `D-`）。

接收端的目的是检测这两个信号之间的**电压差**，而不是它们各自对地的电压。



## 差分信号的工作原理：共模噪声抑制

这是差分对最核心、最强大的优势。

**电气解释：**
1.  在驱动端，一个信号从 `0V` 跳到 `3.3V`（`+`），同时另一个信号从 `3.3V` 跳到 `0V`（`-`）。理想差分电压为 `(+)-(-) = 3.3V - 0V = 3.3V`。
2.  在传输过程中，一个外部噪声（如电源纹波、RF干扰）同样地耦合到了这两条线上。假设给每条线都增加了 `0.2V` 的噪声。
3.  在接收端：
    *   `+` 信号线电压变为：`3.3V + 0.2V = 3.5V`
    *   `-` 信号线电压变为：`0V + 0.2V = 0.2V`
    *   接收器计算的差分电压为：`3.5V - 0.2V = 3.3V`

**结果：** 噪声被完美地抵消了！接收器依然正确地解读到了 `3.3V` 的逻辑“1”。这种同时影响两条线的噪声被称为**共模噪声**，而差分信号天生就对其有极强的免疫力。



## 为什么需要使用差分对？（优势）

**强大的抗干扰能力**

*   如上所述，对共模噪声、电源噪声和串扰有极佳的抑制能力。

**更低的电磁辐射**

*   由于两条线的电流方向相反，它们产生的磁场会相互抵消。同样，电场也会在很大程度上相互抵消。这使得差分信号的EMI（电磁干扰）远低于同等幅度的单端信号。

**对参考平面（地）的依赖性降低**

*   单端信号的返回路径需要一個稳定、干净的地平面。而差分信号的返回路径主要是另一条相位相反的信号线，因此它对“地”的质量要求相对较低，更能容忍参考平面不连续的情况。

**便于低压、高速信号传输**

*   由于抗干扰强，可以使用更低的信号幅度（如LVDS标准只有350mV）。低电压意味着更快的开关速度和更低的功耗，这对于GHz级别的高速总线（如DDR, PCIe, SATA）至关重要。



## 差分对设计的关键参数与规则

要发挥差分对的优势，必须在PCB设计时严格遵守以下规则：

### 差分阻抗
*   这是**最重要的参数**。它是指差分信号在两条线之间传输时所遇到的阻抗。
*   常见的差分阻抗值有 `90Ω`（用于USB、HDMI）、`100Ω`（用于以太网、LVDS、PCIe、SATA）等。
*   **控制方法**：阻抗由**线宽、线间距、介质厚度、介电常数**共同决定。必须使用EDA软件的阻抗计算工具，并与PCB板厂沟通，通过调整这些参数来精确控制阻抗。

### 等长匹配
*   由于接收端检测的是两个信号的**时序差**，如果两条线长度不等，`P`和`N`信号的跳变就无法同时到达接收端，会产生时序偏移。
*   这种时序偏移会：
    *   减小有效的信号电压窗口。
    *   将一部分差分信号转化为共模信号，降低噪声免疫力。
    *   在接收端产生噪声。
*   **设计规则**：必须进行**等长布线**。通常要求长度误差在 `5-10 mils`（0.127 - 0.254 mm）以内，对于极高速信号（如PCIe 4.0/5.0）要求更严格。

### 紧密耦合
*   两条差分线应尽可能靠近布线。这样，任何外部噪声都会**同等地**耦合到两条线上，从而被作为共模噪声最大限度地抑制。
*   **“紧耦合” vs “松耦合”**：现代设计通常推荐紧耦合（线间距 ≤ 线宽），因为它能提供更好的噪声抑制。

### 对称性
*   除了长度，两条线的走线环境也应尽可能对称。
*   **包括**：
    *   使用同一布线层。
    *   旁边避免有其他非对称的信号线。
    *   过孔的数量和位置应对称。
    *   接收端和发送端的终端电阻（如果有）应匹配。



## 布线时差分对交叉处理方法

差分对的优势建立在两根信号线**严格对称**的基础上。任何不对称都会将一部分差分信号转化为共模噪声，降低噪声免疫力。

所以要在保证差分对严格等长和紧耦合的前提下，解决布线路径上的冲突。

### 层内换位 - 最优解

这是最推荐、对信号完整性影响最小的方式。它通过在**同一布线层内**完成交叉，避免了过孔和参考平面切换带来的不连续性。

*   **适用场景**：当差分对需要交换位置以绕过障碍物，或连接到交叉的引脚时。
*   **操作方式**：两根线以平滑的弧线或45度角相互环绕，完成位置交换。
*   **关键要求**：
    1.  **保持紧耦合**：交叉过程中，两条线之间的间距应始终保持不变，符合阻抗控制要求。
    2.  **对称交叉**：交叉点应位于需要交换位置的路径中心，使得交叉前后的线段长度完全相等。
    3.  **避免锐角**：使用圆弧或135度角布线，避免90度角，以减少反射。



### 利用过孔进行立体交叉

当在同一层内无法完成交叉（如空间过于狭窄），或者差分对需要换层时，可以使用此方法。

*   **适用场景**：空间受限的密集区域，或差分对需要切换布线层。
*   **操作方式**：
    1.  在计划交叉的位置，为两根线分别放置过孔，切换到不同的内层。
    2.  在內层中，利用额外的布线空间完成交叉。
    3.  再通过另一组过孔切换回原始层。
*   **关键要求**：
    1.  **过孔对称放置**：两组过孔必须**紧密地、对称地**放置。理想情况下，它们应该是一个“背靠背”的镜像布局。
    2.  **返回路径连续**：在换层处，必须为每一根信号线在附近放置一个**接地过孔**，以确保返回电流有顺畅的低阻抗路径。这是至关重要的一点！
    3.  **严格的长度补偿**：由于引入了过孔（其本身有寄生电容和电感，并带来额外的延时），必须在另一根线上通过**蛇形绕线**来精确补偿这部分长度差。EDA软件的延时匹配功能是关键。



### 在组件封装内解决 - 治本之法

如果交叉是由于芯片的引脚定义本身就是交叉的（例如，BGA封装的差分对引脚排列为`P-N, N-P`），最高效的方法是在组件设计阶段解决。

*   **适用场景**：IC供应商提供的封装其差分引脚序就是交叉的。
*   **操作方式**：
    1.  **原理图处理**：在原理图符号中，直接将差分对的网络标签交换。这样，从逻辑上就完成了交叉。
    2.  **PCB封装处理**：在创建PCB封装时，直接将焊盘的位置交换。这是更优的方法，因为它允许在原理图上使用直观的连线。
*   **优点**：这是最干净、最根本的解决方案。一旦在封装层面解决，PCB布线时就无需任何交叉操作，只需直接拉线即可，保证了最佳的信号质量。



## 常见差分对标准与应用

*   **USB 2.0**： `90Ω` 差分阻抗。
*   **HDMI**： `100Ω` 差分阻抗（对TMDS时钟和数据通道）。
*   **以太网 (RJ45)**： `100Ω` 差分阻抗。
*   **LVDS**： `100Ω` 差分阻抗（广泛应用于液晶屏接口、高速背板）。
*   **PCI Express, SATA**： `100Ω` 差分阻抗。
*   **CAN总线**： `120Ω` 差分阻抗（用于汽车、工业领域）。



## 总结

**差分对**是一种通过传输两个相位相反的信号，并检测其电压差来工作的技术。它的核心价值在于其**与生俱来的共模噪声抑制能力**，这使得它在**高速、高噪声环境、低电压、低功耗**的应用中成为不可替代的解决方案。

成功运用差分对的关键在于精确的**阻抗控制**和严格的**等长匹配**。当您在设计USB、HDMI或任何高速串行总线时，处理好差分对是保证信号完整性和系统稳定性的基石。