# 等长布线

## 为什么需要等长布线

在低速电路中，电信号传播速度极快，走线长度差异可以忽略不计。但在**高速数字电路**中，信号边沿陡峭，频率极高，电信号在PCB走线上的传播延迟变得不可忽视。

等长布线的根本目的是：保证一组相关的信号（总线或差分对）能够**同时到达**接收端，以满足接收芯片的建立时间 和保持时间要求，确保数据被正确采样。

如果长度不等，就会导致**信号偏移**，可能引起数据采样错误，导致系统不稳定。



## 关键应用场景

等长布线并非适用于所有信号，主要针对以下两类：

### 差分对
*   **代表**：USB、HDMI、PCIe、SATA、以太网、LVDS。
*   **为什么需要等长**：差分信号依靠两个相位相反的信号（D+和D-）的电压差来传递信息。如果长度不等，相位差就会偏离180°，导致：
    1.  共模噪声抑制能力下降。
    2.  信号边沿错位，有效数据窗口变小。
    3.  差分信号能量转化为共模能量，增加EMI。
*   **要求**：非常严格，长度误差通常要求在 **±5 mils (0.127mm)** 以内。

### 并行总线
*   **代表**：**DDR SDRAM** 是其中最典型的例子，此外还有早期的CPU总线等。
*   **为什么需要等长**：以DDR为例，它采用**源同步时序**，即数据和数据选通信号（DQS）由驱动端（如内存控制器）同时发出。
    *   **数据组** 内的所有信号（如DQ0-DQ7）必须与它们的**DQS信号** 等长。
    *   **地址/命令/控制组** 的所有信号必须与**时钟信号（CLK）** 等长。
*   **要求**：比差分对稍宽松，但依然严格。通常要求在同一组内，信号长度与目标长度（或组内最长线）的误差在 **±25 mils (0.635mm)** 以内，具体需查阅芯片数据手册。



## 关键概念与设计参数

**匹配容差**：

*   指一组信号线之间允许的**最大长度差异**。这是等长布线的核心目标值，由芯片厂商在数据手册中规定。

**总长** 与 **相对长度**：

*   **总长**：单根信号从起点到终点的绝对长度。
*   **相对长度**：一组信号中，各信号线相对于一个**目标长度**（通常是组内最长的“基准线”）的长度差。EDA软件通常以“蛇形线”的形式显示这个差值。

**传播速度与延时**：

*   信号在PCB介质中的传播速度约为 `6 inch/ns`（约15 cm/ns）。
*   这意味着每 `1000 mils`（1英寸）的走线，会产生约 `167 ps` 的延时。
*   等长布线本质上是**延时匹配**，但由于延时与长度成正比，我们通常直接用长度来匹配。



## 蛇形走线

当走线的**自然长度**（最短路径）不足时，我们需要通过**蛇形走线** 来增加额外的长度，以达到等长目的。

通过蛇形走线来补偿较短的走线，使其与基准线等长

**蛇形走线的设计规则（黄金法则）：**

**间距规则**：

*   **线到线间距** ≥ **2倍线宽**。
*   **原因**：如果间距过小，蛇形线相邻线段之间的耦合会急剧增加，导致局部阻抗降低和串扰，这被称为**紧耦合**，反而会恶化信号质量。

**高度规则**：

*   **蛇形线高度** ≥ **3倍线宽**。
*   **原因**：确保有足够的“绕线”空间，避免出现急弯。

**避免多重蛇形**：

*   尽量使用**单一、连续**的蛇形段，而不是多个小段的组合。



## 等长布线流程

**前期规划**：

*   阅读主控芯片和存储芯片的数据手册，确定**等长组**和**匹配容差**。
*   在EDA软件（如Altium Designer, Cadence Allegro）中设置**等长规则**。

**布局与基准线布线**：

*   先进行关键器件的布局（如CPU与DDR的位置）。
*   优先布设**时钟线**和**DQS选通信号**，它们通常是组内最长的“基准线”。

**绕线匹配**：

*   布设组内其他信号，尽量走最短路径。
*   使用EDA软件的**等长布线**功能，软件会自动计算长度差，并提示你需要绕线的长度。
*   在路径空间充裕的地方添加蛇形走线。

**检查与验证**：

*   使用DRC功能检查所有等长组是否满足规则。
*   对关键网络进行**信号完整性仿真**，验证等长后的波形质量。



## 总结

**等长布线是高速数字电路设计的基石。** 它不再是可有可无的“优化”，而是保证系统稳定运行的**必要条件**。

*   **核心价值**：通过控制物理长度来匹配时序，确保数据正确传输。
*   **关键技能**：掌握蛇形走线的正确方法，避免引入新的信号完整性问题。
*   **设计思想**：从“连通即可”上升到“时序为先”。

