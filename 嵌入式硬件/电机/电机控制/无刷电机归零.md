# 无刷电机位置归零

归零的目的是让电机的控制系统知道转子的**绝对位置**（0度或Home位置）。

无刷电机本身没有绝对的物理零点，它需要依靠**位置传感器**（如编码器、霍尔传感器）来反馈转子位置。因此，归零操作的核心是**让传感器的读数与电机的机械位置建立一个已知的对应关系**。

以下是几种常见的归零操作方法，从简单到复杂排列：

## 使用霍尔传感器的简单归零（低成本方案）

许多低成本无刷电机使用3个霍尔传感器来估算大致位置（每60或120度电角度一个点）。这种方法精度不高，但足以实现启动和低速控制。

**操作步骤：**
1.  **缓慢通电**：给电机绕组施加一个很小的、固定的电流矢量（例如，让U相正偏，V相和W相负偏一半电流）。
2.  **吸引转子**：这个电流会产生一个固定的磁场，将转子吸引并牢牢锁定在一个特定的位置（这个位置由电流方向决定）。
3.  **读取霍尔状态**：在转子被锁定后，读取此时三个霍尔传感器的值（通常是一个3位的二进制数，如101）。
4.  **定义为零点**：在控制器中，将这个特定的霍尔状态定义为你系统的机械零点。之后的所有位置控制都基于这个零点进行偏移。

**优点**：简单、快速、成本低。
**缺点**：精度低（只能精确到60度电角度），归零时电机可能会轻微抖动。



## 使用增量式编码器的归零（最常用方案）

增量式编码器没有断电记忆功能，因此每次上电后都需要寻找一次零点（Index或Z信号）。

**操作步骤：**
1.  **寻找Z脉冲（Index Mark）**：
    *   控制器驱动电机以较低的速度朝一个方向（例如正转）旋转。
    *   增量式编码器在旋转时会输出A、B两相脉冲和一个每圈一次的Z脉冲（零点脉冲）。
    *   控制器持续监控编码器信号，一旦检测到Z脉冲，立即停止电机。
2.  **定位零点**：
    *   检测到Z脉冲的瞬间，转子所在的位置就是编码器定义的机械零点。控制器可以将此时的位置计数器清零。
    *   **注意**：Z脉冲通常有一定的宽度，精确的系统会在Z脉冲的**上升沿**或**下降沿**触发清零动作，以提高重复定位精度。

**优点**：精度高，可靠性好，是工业上的标准做法。
**缺点**：需要电机旋转至少一圈才能找到零点。



## 使用绝对式编码器的归零（高端方案）

绝对式编码器上电后就能直接读出绝对位置值，无需旋转找零点。这里的“归零”操作实际上是**标定（Calibration）**。

**操作步骤：**
1.  **机械安装对齐**：
    *   首先，将电机轴手动旋转到你希望定义为机械零点的位置（例如，机器人关节的伸直状态）。
    *   保持这个位置不动，安装绝对式编码器，并确保编码器固定牢靠。
2.  **位置标定**：
    *   上电，读取此时绝对式编码器输出的原始值（例如，16384）。
    *   在控制器的参数表中，将这个原始值设置为“偏移量（Offset）”或直接存入零点位置寄存器。
    *   此后，控制器读取的编码器值减去这个偏移量，就是相对于机械零点的位置。

**优点**：上电即知位置，无需归零旋转过程，最快最方便。
**缺点**：绝对式编码器成本较高，且初始安装标定需要仔细。



## 通过电感检测（无传感器方案）

对于一些没有位置传感器的无刷电机（Sensorless BLDC），可以通过检测绕组电感的饱和效应来估算转子位置。

**操作步骤：**
1.  **注入高频信号**：向电机绕组注入一个高频测试信号。
2.  **检测电流响应**：转子位置不同，绕组的电感值会略有变化（因为永磁体磁场会导致磁芯饱和），这会影响电流的响应幅度。
3.  **计算位置**：通过检测和比较不同绕组上的电流响应，可以估算出转子所在的大致角度区域，从而确定一个“电气零点”。
4.  **对齐**：将这个估算出的电气零点与机械系统对齐。

**优点**：无需额外的硬件传感器。
**缺点**：算法复杂，精度和可靠性较低，通常只用于启动阶段，不适合高精度定位。

### 高频信号注入法（High-Frequency Signal Injection, HFSI）

### 核心思想：利用磁饱和效应带来的电感变化

要理解这个方法，首先要明白一个关键物理现象：**磁饱和**。

1.  **电感的定义**：电机绕组的电感（L）表示其抵抗电流变化的能力。
2.  **磁饱和的影响**：电机的铁芯材料存在磁饱和特性。当外部磁场（来自永磁体的磁场）与绕组自身电流产生的磁场方向一致时，铁芯会更容易接近饱和状态。**处于磁饱和状态下的铁芯，其电感会减小**。
3.  **转子位置的影响**：转子上永磁体的磁场方向直接决定了每个绕组附近的背景磁场强度。因此，**对于某一相绕组（如U相）来说，它的电感值会随着转子位置的变化而变化**。当转子磁极正对着该绕组时，该绕组的电感最小；当转子磁极错开该绕组时，其电感最大。

**结论：转子位置 → 决定各相绕组电感值 → 电感值影响电流的响应特性。** 因此，我们可以通过测量电流的响应来反推转子位置。



### “高频信号”如何工作？

这个“高频信号”不是一个用于驱动电机旋转的功率信号，而是一个用于“探测”的测试信号。

#### 1. 信号是什么？
*   **形式**：通常是一个频率较高（几百Hz到几kHz）、幅度较低的**正弦电压波**或**脉冲电压（PWM）**。
*   **特点**：
    *   **高频**：选择的频率远高于电机的正常运行频率，因此这个信号产生的磁场变化太快，无法使电机转子产生有效的旋转扭矩（转子由于惯性跟不上这么快的磁场变化），所以电机不会因此转动。
    *   **低幅值**：电压和电流的幅值很小，同样是为了避免驱动转子转动，只作为探测之用。

#### 2. 如何注入和检测？
控制器会通过逆变器向电机绕组中注入这个高频电压信号。注入的方式有多种，例如：
*   **旋转高频电压注入**：在估计的同步旋转坐标系（d-q轴）上注入。
*   **脉振高频电压注入**：在静止的α-β坐标系或直接向三相绕组注入。

注入后，控制器会**检测三相的电流响应**。

#### 3. 电流响应如何揭示位置？
这是最关键的一步。根据电磁学公式 `V = L * di/dt`（电压 = 电感 * 电流变化率），可以变形为 `di/dt = V / L`。

*   **电感大（L大）** => 电流变化率慢（`di/dt` 小）=> 电流幅值小、上升慢。
*   **电感小（L小）** => 电流变化率快（`di/dt` 大）=> 电流幅值大、上升快。

由于各相电感的大小取决于转子位置，因此**三相电流响应的幅值（或包络）也包含了转子位置信息**。

**举个例子：**
假设我们向三相绕组注入一个相同的高频电压信号。
*   如果检测发现**U相**的电流响应幅值**最大**（即电流上升最快），说明U相绕组的**电感最小**。
*   电感最小意味着转子永磁体的磁场方向与U相绕组的磁场方向对齐得最正，导致其磁饱和最严重。
*   由此，控制器就可以推断出：**转子目前正处在与U相对齐的位置附近**。

通过复杂的信号处理算法（如包络检测、滤波、锁相环等），对电流响应进行分析，就可以估算出转子的精确角度（通常是某个区间内的绝对位置）。



### 总结：高频信号注入法的特点

*   **目的**：在电机零速或极低速下，无传感器地探测转子**绝对位置**。
*   **物理基础**：利用永磁体磁场导致的**磁饱和效应**，使绕组电感随转子位置变化。
*   **信号特性**：**高频、低幅值**的电压信号，仅用于探测，不产生有效扭矩。
*   **实现方式**：注入电压信号，检测并比较三相的**电流响应幅值/相位**，通过算法解算出位置。
*   **优点**：解决了无传感器电机启动的“盲区”问题，可实现零速带载启动。
*   **缺点**：
    *   需要复杂的信号处理算法，对处理器算力有要求。
    *   可能会引入额外的音频噪音（高频信号导致）。
    *   精度和可靠性通常仍低于物理编码器。
    *   不适合所有类型的电机（在凸极性不明显的表贴式电机中效果较差）。

这种方法常见于高级的无传感器FOC（磁场定向控制）算法中，用于高性能的无人机电调、高端家电（如空调压缩机）、电动工具等需要平稳启动和低速大扭矩的场景。

