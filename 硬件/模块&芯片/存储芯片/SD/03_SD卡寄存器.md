# SD卡寄存器

## 寄存器基本介绍

SD卡总共有8个寄存器，用于设定或表示SD卡信息。

| 寄存器  | 描述                                         | 长度    | 作用定位                                                     | 访问命令         |
| ------- | -------------------------------------------- | ------- | ------------------------------------------------------------ | ---------------- |
| **OCR** | 操作条件寄存器 Operation Conditions Register | 32 bit  | 包含卡的工作电压范围、上电状态、电池电压信息等。             | CMD58            |
| **CID** | 卡识别号 Card Identification                 | 128 bit | 卡的唯一识别信息，包含厂商ID、产品型号、序列号等。           | CMD2             |
| **RCA** | 相对地址 Relative Card Address               | 16 bit  | 相对地址，卡的本地系统地址。在卡初始化过程中，动态地由SD卡会动态分配这个地址，经过主机核准后主机会使用这个地址来选择特定的卡。 | CMD3             |
| **DSR** | 驱动级寄存器 Driver Stage Register           | 16 bit  | 配置卡的驱动能力，通常用于调整卡的输出驱动电流等，但在实际应用中少有操作。 | CMD4             |
| **CSD** | 卡的特定数据 Card Specific Data              | 128 bit | 卡的特定数据，包括卡的容量、支持的功能（如最大块大小）等信息。 | CMD9             |
| **SCR** | SD配置寄存器 SD Configuration Register       | 64 bit  | SD卡配置寄存器，包含关于 SD 卡的功能特性，如总线宽度（1-bit / 4-bit）、支持的安全特性等。 | CMD55 + ACMD51   |
| **SSR** | SD状态 SD Status                             | 512 bit | 包含SD卡专有状态信息，如擦除状态、安全状态、性能信息等。     | CMD55 + ACMD13   |
| **CSR** | 卡状态 Card Status                           | 32 bit  | 卡的状态，包含命令执行状态、错误标志、当前状态机的状态等信息。 | 所有命令的R1响应 |

### 图片

![](./pic/SDcard001.png)

## OCR操作条件寄存器

**OCR寄存器结构：**

OCR是一个**32位寄存器**，具体位定义如下：

```text
31 30 29 28 27 26 25 24 23 22 21 20 19 18 17 16 15 14 13 12 11 10 9  8  7  6  5  4  3  2  1  0
|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
└──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┴──┘

位31: 卡上电状态 (Busy)
位30: 卡容量状态 (CCS)
位23-15: 电压窗口
位7-0: 保留
```

**详细位说明：**

**位31 - 卡上电状态 (Card Power Up Status)**

-   **功能**：指示卡是否完成上电初始化过程
-   **状态**：
    -   `0` = 卡正在初始化（忙状态）
    -   `1` = 卡初始化完成，可以接受命令
-   **重要性**：主机必须等待此位变为1才能继续后续操作

**位30 - 卡容量状态 (Card Capacity Status)**

-   **功能**：指示SD卡容量类型
-   **状态**：
    -   `0` = 标准容量SD卡 (SDSC, ≤2GB)，使用字节寻址
    -   `1` = 高容量SD卡 (SDHC, 2GB-32GB) 或扩展容量卡 (SDXC, 32GB-2TB)，使用块寻址
-   **影响**：决定了后续读写操作的寻址方式

**位23-15 - 电压窗口 (Voltage Window)**

每个位代表一个特定的电压范围：

| 位置     | 位15     | 位16     | 位17     | 位18     | 位19     | 位20     | 位21     | 位22     | 位23     | 位24     | 位25     | 位26     | 位27     | 位28     | 位29     | 位30     |
| -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 电压范围 | 2.0-2.1V | 2.1-2.2V | 2.2-2.3V | 2.3-2.4V | 2.4-2.5V | 2.5-2.6V | 2.6-2.7V | 2.7-2.8V | 2.8-2.9V | 2.9-3.0V | 3.0-3.1V | 3.1-3.2V | 3.2-3.3V | 3.3-3.4V | 3.4-3.5V | 3.5-3.6V |
| 说明     | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 很少使用 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 | 常用范围 |





## CID卡识别号寄存器

只读寄存器，使用 CMD2 获取。

内容结构：

| 字段 | 位宽 | 说明     |
| ---- | ---- | -------- |
| MID  | 8    | 厂商 ID  |
| OID  | 16   | OEM      |
| PNM  | 40   | 产品名   |
| PRV  | 8    | 版本     |
| PSN  | 32   | 序列号   |
| MDT  | 12   | 生产日期 |
| CRC  | 7    | CRC 校验 |

用途：

-   调试打印
-   区分卡厂商
-   不参与初始化决策

## RCA相对地址寄存器

**获取方式**：`CMD3`

**由卡分配（SD 模式）**



-   多卡总线区分
-   后续命令全部使用 RCA

```
CMD7 → Select Card (使用 RCA)
```

## DSR驱动级寄存器

配置卡的驱动能力，通常用于调整卡的输出驱动电流等，但在实际应用中少有操作。



## CSD卡的特定数据寄存器

使用 CMD9 获取

SDSC类型卡对应**CSD v1.0**

SDHC / SDXC 类型卡对应**CSD v2.0**

**解析方式完全不同**

用于

-   计算 **容量**
-   最大读写速度
-   块长度支持

SDHC / SDXC 容量计算

```
容量 = (C_SIZE + 1) × 512 KB
```

### CSD v1.x解析

1.  **CSD Structure (CSD_STRUCTURE) - 位 [127:126]**
     该字段用于指示 **CSD 版本**。对于 **CSD v1.0**，该值应为 `0x01`（即 `01` 二进制）。
2.  **TAAC (数据访问时间) - 位 [111:104]**
     该字段表示数据访问时间，单位为时钟周期。此值通常为 `0x0E`（14个时钟周期）。
3.  **NSAC (名义供应电压时间) - 位 [103:96]**
     表示卡的响应时间与电压的相关性。`0x00` 表示卡无需额外延迟。
4.  **TRAN_SPEED (最大数据传输速率) - 位 [95:88]**
     该字段表示最大数据传输速率，通常用 `0x32` 表示，等于 **50MB/s**。
5.  **CCC (卡命令类) - 位 [83:72]**
     该字段表示 SD 卡支持的命令类。一般使用 16 进制表示，例如 `0x5B59`。
6.  **READ_BL_LEN (读取块大小) - 位 [83:72]**
     该字段表示每个数据块的大小，通常是 **512 字节**，即 `0x20`。
7.  **WRITE_BL_LEN (写入块大小) - 位 [71:64]**
     该字段表示卡支持的写入块大小，通常为 **512 字节**，即 `0x20`。
8.  **CCS (卡容量状态) - 位 [47:46]**
     该字段指示卡的容量状态：
    -   `0x00`：表示该卡为 **SDSC** 类型，最大容量为 2GB。
    -   `0x01`：表示该卡为 **SDHC** 类型（大于 2GB），但对于 **CSD v1.0**，此字段一般为 `0x00`。
9.  **最大块地址 (MAX_BLOCK_ADDR) - 位 [63:48]**
     该字段表示 SD 卡的最大块地址，用于计算卡的总容量。
10.  **保留和 CRC - 位 [45:0]**
      这些字段用于数据校验和保留位。

### CSD v2.x解析

1.  **CSD Structure Version (CSD_STRUCTURE) - 位 [127:126]**
     提取这两位：`0100 0000` -> `0x01`
     **解释**：表示 **CSD v2.0** 格式（SDHC/SDXC）。
2.  **TAAC (数据访问时间) - 位 [111:104]**
     提取：`0000 1110` -> `0x0E`
     **解释**：表示 **14 个时钟周期**（TAAC）。
3.  **NSAC (名义供应电压时间) - 位 [103:96]**
     提取：`0000 0000` -> `0x00`
     **解释**：表示 **0**，没有延迟。
4.  **TRAN_SPEED (最大数据传输速率) - 位 [95:88]**
     提取：`0011 0010` -> `0x32`
     **解释**：表示 **50 MB/s** 传输速度。
5.  **CCC (卡命令类) - 位 [83:72]**
     提取：`0101 1011 0101 1001` -> `0x5B59`
     **解释**：该值表示卡支持的多个命令类。
6.  **READ_BL_LEN (读取块大小) - 位 [83:72]**
     提取：`0000 0011` -> `0x32`
     **解释**：读取块的大小为 **512 字节**。
7.  **WRITE_BL_LEN (写入块大小) - 位 [71:64]**
     提取：`0000 0000` -> `0x00`
     **解释**：该字段为空，可能与卡类型相关，默认块大小为 **512 字节**。
8.  **CCS (卡容量状态) - 位 [47:46]**
     提取：`10` -> `0x02`
     **解释**：`0x01` 表示 **SDHC/SDXC 卡**，因此这是一张大于 2GB 的卡。
9.  **最大块地址 (Max Block Address) - 位 [63:48]**
     提取：`1110 0111 1010 1101 0000 0111 1000 0000` -> `0xE7AD0780`
     **解释**：该值表示 **最大块地址**。



## SCR配置寄存器

基本信息

-   **长度**：64 bit
-   **获取方式**：
    -   `CMD55` + `ACMD51`
-   **通过数据线读取**

------

核心字段

| 字段      | 作用           |
| --------- | -------------- |
| SD_SPEC   | SD 版本        |
| BUS_WIDTH | 是否支持 4-bit |
| SECURITY  | 安全特性       |

**是否能切 4-bit 总线，就看 SCR**



## SSR状态寄存器

基本信息

-   **长度**：512 bit（64 字节）
-   **获取方式**：
    -   `CMD55` + `ACMD13`

工程用途

-   当前总线宽度
-   写保护状态
-   性能信息

**主要用于诊断，不是初始化必需**



## CSR卡状态寄存器 (并不实际存在 只是响应)

代表卡状态 Card Status，并不实际存在，组为所有命令的R1响应。

| Bit   | 名称               | 含义                               | 正常值   |
| ----- | ------------------ | ---------------------------------- | -------- |
| 0~8   | RESERVED           | 保留                               | 0        |
| 9     | READY_FOR_DATA     | 卡是否准备好传输数据               | 可用 = 1 |
| 10    | APP_CMD            | 下一个命令是应用命令（ACMD）       | 0/1      |
| 11    | RESERVED           | 保留                               | 0        |
| 12~16 | CURRENT_STATE      | 卡状态机                           | 取值 0~7 |
| 17~18 | RESERVED           | 保留                               | 0        |
| 19    | ERROR              | 通用错误                           | 0        |
| 20    | CC_ERROR           | 内部控制器错误（CSD/CID 校验失败） | 0        |
| 21    | CARD_ECC_FAILED    | ECC 校验失败                       | 0        |
| 22    | ILLEGAL_COMMAND    | 非法命令                           | 0        |
| 23    | COM_CRC_ERROR      | 命令 CRC 错误                      | 0        |
| 24    | LOCK_UNLOCK_FAILED | 锁/解锁失败                        | 0        |
| 25    | CARD_IS_LOCKED     | 卡已锁定                           | 0        |
| 26    | WP_VIOLATION       | 写保护违规                         | 0        |
| 27    | ERASE_PARAM        | 擦除参数错误                       | 0        |
| 28    | ERASE_SEQ_ERROR    | 擦除顺序错误                       | 0        |
| 29    | BLOCK_LEN_ERROR    | 块长度错误                         | 0        |
| 30    | ADDRESS_ERROR      | 地址错误                           | 0        |
| 31    | OUT_OF_RANGE       | 地址越界错误                       | 0        |

```
0000 0000 0000 0xxx xxxx xxx1 0000 0000
1111 1111 1111 1000 0000 0000 1111 1111
```

